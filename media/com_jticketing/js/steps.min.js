/**
 * @package     JTicketing
 *
 * @author      Techjoomla <extensions@techjoomla.com>
 * @copyright   Copyright (C) 2009 - 2024 Techjoomla. All rights reserved.
 * @license     GNU General Public License version 2 or later; see LICENSE.txt
 * unified Ajax request handler which will work like a entry point for all ajax call generated from the JTicketing component
 */
if(void 0===JTicketing)var JTicketing={};!function($){$(document).ready((function(){$(document).on("change","#ticketsTypes",(function(){var addItem=$(this),parentDiv=$(".js-jt-ticket-listing");parentDiv.addClass("isloading"),JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",data:{task:"order.addItem",orderId:parseInt(addItem.data("order-id")),typeId:parseInt(this.value),view:"order"}}).done((function(result){!0===result.success?(parentDiv.empty(),parentDiv.html(result.data),parentDiv.trigger("subform-row-add",$(".js-jt-ticket-listing"))):Joomla.renderMessages({error:[result.message]})})).fail((function(content){Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_ORDER_RELATED_AJAX_FAIL_ERROR_MESSAGE")]})})).always((function(){parentDiv.removeClass("isloading"),$("#ticketsTypes").chosen()}))}))})),$(document).on("click",".proceedCheckout",(function(e){var proceedCheckout=$(this),orderId=parseInt(proceedCheckout.data("order-id"));JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",data:{task:"order.proceedToCheckout",orderId:orderId}}).done((function(result){!0===result.success?(1===ga_ec_analytics&&jtSite.order.addEcTrackingData(orderId,2),window.parent.location=result.data):(Joomla.renderMessages({error:[result.message]}),jQuery("html, body").animate({scrollTop:0},"slow"))})).fail((function(content){Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_ORDER_RELATED_AJAX_FAIL_ERROR_MESSAGE")]}),jQuery("html, body").animate({scrollTop:0},"slow")}))})),$(document).on("click",".attendeeCheckout",(function(e){var attendeeForm=document.attendee_field_form,attendeeCheckout=$(this),orderId=parseInt(attendeeCheckout.data("order-id")),attendeeButton=$("#attendeeCheckout");if(!document.formvalidator.isValid(attendeeForm))return $("html, body").animate({scrollTop:0},"slow"),e.preventDefault();$(".alert-error").hide();var values=$("#attendee_field_form").serialize();values+="&orderId="+orderId,JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",data:{task:"order.addAttendee",orderId:orderId,attendee_field:values},beforeSend:function(){attendeeButton.attr("disabled",!0),attendeeButton.addClass("btn-loading")}}).done((function(result){attendeeButton.attr("disabled",!1),!1===result.success?(Joomla.renderMessages({error:[result.message]}),$("html, body").animate({scrollTop:0},"slow")):(1===ga_ec_analytics&&jtSite.order.addEcTrackingData(orderId,3),window.location.href=result.data),attendeeButton.removeClass("btn-loading")})).fail((function(content){Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_ORDER_RELATED_AJAX_FAIL_ERROR_MESSAGE")]}),jQuery("html, body").animate({scrollTop:0},"slow")}))})),$(document).on("click",".removeItem",(function(){var removeItem=$(this),typeId=parseInt(removeItem.data("ticket-type-id")),inputVal=parseInt($(".ticketInput"+typeId).val()),parentDiv=$(".js-jt-ticket-listing");if(parentDiv.addClass("isloading"),0==inputVal)return parentDiv.removeClass("isloading"),void $("#ticketsTypes").chosen();inputVal=--inputVal,$(".ticketInput"+typeId).val(inputVal),JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",data:{task:"order.removeItem",orderId:parseInt(removeItem.data("order-id")),typeId:typeId,view:"order"}}).done((function(result){!0===result.success?(parentDiv.empty(),parentDiv.html(result.data)):($(".ticketInput"+typeId).val(++inputVal),Joomla.renderMessages({error:[result.message]}))})).fail((function(content){$(".ticketInput"+typeId).val(++inputVal),Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_ORDER_RELATED_AJAX_FAIL_ERROR_MESSAGE")]}),jQuery("html, body").animate({scrollTop:0},"slow")})).always((function(){parentDiv.removeClass("isloading"),$("#ticketsTypes").chosen()}))})),$(document).on("click",".addItem",(function(){var addItem=$(this),checkoutLimit=parseInt(addItem.data("checkout-limit")),unlimitedTicket=parseInt(addItem.data("unlimited-ticket")),typeId=parseInt(addItem.data("ticket-type-id")),inputVal=parseInt($(".ticketInput"+typeId).val()),parentDiv=$(".js-jt-ticket-listing");if(parentDiv.addClass("isloading"),inputVal>=checkoutLimit&&!unlimitedTicket)return Joomla.renderMessages({error:[Joomla.JText._("JT_PERUSER_PER_PURCHASE_LIMIT_ERROR")]}),parentDiv.removeClass("isloading"),void $("#ticketsTypes").chosen();$(".ticketInput"+typeId).val(++inputVal),$("#coupon_troption").show(),JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",data:{task:"order.addItem",orderId:parseInt(addItem.data("order-id")),typeId:typeId,view:"order"}}).done((function(result){!0===result.success?(parentDiv.empty(),parentDiv.html(result.data)):($(".ticketInput"+typeId).val(Math.max(0,inputVal-1)),Joomla.renderMessages({error:[result.message]}),jQuery("html, body").animate({scrollTop:0},"slow"))})).fail((function(content){$(".ticketInput"+typeId).val(Math.max(0,inputVal-1)),Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_ORDER_RELATED_AJAX_FAIL_ERROR_MESSAGE")]}),jQuery("html, body").animate({scrollTop:0},"slow")})).always((function(){parentDiv.removeClass("isloading"),$("#ticketsTypes").chosen()}))})),$(document).on("click",".removeCoupon",(function(){var parentDiv=$(".js-jt-ticket-listing");parentDiv.addClass("isloading");var removeCoupon=$(this),couponCode=$("#coupon_code").val();JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",data:{task:"order.removeCoupon",couponCode:couponCode,orderId:parseInt(removeCoupon.data("order-id")),view:"order"}}).done((function(result){!0===result.success?(parentDiv.empty(),parentDiv.html(result.data)):result.message&&Joomla.renderMessages({error:[result.message]})})).fail((function(content){Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_ORDER_RELATED_AJAX_FAIL_ERROR_MESSAGE")]}),jQuery("html, body").animate({scrollTop:0},"slow")})).always((function(){parentDiv.removeClass("isloading"),$("#ticketsTypes").chosen(),$("#ticketsTypes").length&&parentDiv.trigger("subform-row-add",$(".js-jt-ticket-listing"))}))})),$(document).on("click",".applyCoupon",(function(){var parentDiv=$(".js-jt-ticket-listing");parentDiv.addClass("isloading");var applyCoupon=$(this);if(""==$("#coupon_code").val())return alert(Joomla.JText._("ENTER_COP_COD")),parentDiv.removeClass("isloading"),void $("#ticketsTypes").chosen();parentDiv.addClass("isloading");var couponCode=document.getElementById("coupon_code").value;JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",data:{task:"order.applyCoupon",couponCode:couponCode,orderId:parseInt(applyCoupon.data("order-id")),view:"order"}}).done((function(result){!1!==result.success?(parentDiv.empty(),parentDiv.html(result.data)):alert(couponCode+" "+result.message)})).fail((function(content){Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_ORDER_RELATED_AJAX_FAIL_ERROR_MESSAGE")]}),jQuery("html, body").animate({scrollTop:0},"slow")})).always((function(content){parentDiv.removeClass("isloading"),$("#ticketsTypes").chosen(),$("#ticketsTypes").length&&parentDiv.trigger("subform-row-add",$(".js-jt-ticket-listing"))}))})),$(document).on("click",".billingCheckout",(function(e){var billingForm=document.billing_info_form,addItem=$(this),consentItem,consent=$("#accept_privacy_term").data("consent"),checkoutButton=$("#billingCheckout"),namePattern=/^[a-zA-Z\s-]+$/,regexForAttendeeMob=$(".regexForAttendeeMob").val();if(regexForAttendeeMob=new RegExp(regexForAttendeeMob),!document.formvalidator.isValid(billingForm)){var msg="";return consent&&!1===document.getElementById("accept_privacy_term").checked&&(msg=Joomla.JText._("COM_JTICKETING_PRIVACY_TERMS_AND_CONDITIONS_ERROR"),Joomla.renderMessages({error:[msg]})),$("html, body").animate({scrollTop:0},"slow"),e.preventDefault()}if(jQuery("#fname").length&&jQuery("#fname").length&&""!=jQuery("#fname").val()&&!namePattern.test(jQuery("#fname").val())){var error_html=Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+Joomla.JText._("COM_JTICKETING_INVALID_BILLING_FNAME");return Joomla.renderMessages({error:[error_html]}),jQuery("html, body").animate({scrollTop:0},"slow"),!1}if(jQuery("#lname").length&&jQuery("#lname").length&&""!=jQuery("#lname").val()&&!namePattern.test(jQuery("#lname").val())){var error_html=Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+Joomla.JText._("COM_JTICKETING_INVALID_BILLING_LNAME");return Joomla.renderMessages({error:[error_html]}),jQuery("html, body").animate({scrollTop:0},"slow"),!1}if(jQuery("#phone").length&&jQuery("#phone").length&&""!=jQuery("#phone").val()&&!regexForAttendeeMob.test(jQuery("#phone").val())){var error_html=Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+Joomla.JText._("COM_JTICKETING_INVALID_BILLING_MOB");return Joomla.renderMessages({error:[error_html]}),jQuery("html, body").animate({scrollTop:0},"slow"),!1}$(".alert-error").hide();var billingValues=$("#billing_info_form").serialize(),orderId=parseInt(addItem.data("order-id"));JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",data:{task:"order.addBillingData",billingValues:billingValues,orderId:parseInt(addItem.data("order-id")),checkout_method:$('input[name="account_jt"]:checked').val()},beforeSend:function(){checkoutButton.attr("disabled",!0),checkoutButton.addClass("btn-loading")}}).done((function(result){if(checkoutButton.attr("disabled",!1),!0===result.success){if(1===ga_ec_analytics){var stepId=3;1===track_attendee_step&&(stepId=4),jtSite.order.addEcTrackingData(orderId,stepId)}document.location=result.data}else Joomla.renderMessages({error:[result.message]}),$("html, body").animate({scrollTop:0},"slow");checkoutButton.removeClass("btn-loading")})).fail((function(content){Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_ORDER_RELATED_AJAX_FAIL_ERROR_MESSAGE")]}),$("html, body").animate({scrollTop:0},"slow")}))})),$(document).on("click",".orderLogin",(function(){var orderLogin=$(this),buttonLogin=$("#button-login");JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",data:{task:"order.loginValidate",email:$("#loginEmail").val(),password:$("#loginPassword").val(),orderId:orderLogin.data("order-id")},beforeSend:function(){buttonLogin.attr("disabled",!0),buttonLogin.addClass("btn-loading")}}).done((function(result){buttonLogin.attr("disabled",!1),!1===result.success?(Joomla.renderMessages({error:[result.message]}),$("html, body").animate({scrollTop:0},"slow")):window.parent.location=result.data,buttonLogin.removeClass("btn-loading")}))})),$(document).on("blur","#email1",(function(){var emailField=$("#email1"),email=emailField.val(),userId;if(emailField.data("user-id")>0)return!0;JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&view=order&task=order.checkUserEmailId&email="+email,type:"GET"}).done((function(result){!0===result.success?($("#billing_info_data").show(),$("#btnWizardNext").removeAttr("disabled"),$("#btnWizardNext").show()):($("#user_info").show(),$("#btnWizardNext").hide(),Joomla.renderMessages({error:[result.message]}),$("html, body").animate({scrollTop:0},"slow"))})).fail((function(){Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_ORDER_RELATED_AJAX_FAIL_ERROR_MESSAGE")]}),$("html, body").animate({scrollTop:0},"slow")}))}))}(JTQuery);