/*
 * @package    JTicketing
 * @author     Techjoomla <extensions@techjoomla.com>
 *
 * @copyright  Copyright (c) 2009-2020 TechJoomla. All rights reserved.
 * @license    GNU General Public License version 2 or later.
 */
var jtSite={events:{init:function(){jQuery(document).ready((function(){1!=localStorage.getItem("flag")&&0==localStorage.getItem("flag")||jQuery(".events__filter").toggleClass("hide active")}))},toggleDiv:function(spanId){jQuery(window).width()<767&&jQuery("#"+spanId).toggle(),1==localStorage.getItem("flag")?localStorage.setItem("flag",0):localStorage.setItem("flag",1),jQuery(".events__filter").toggleClass("hide active"),jQuery(".events__filter").is(":visible")?jQuery("#mobiledisplayFilter").html("<i class='fa mr-5 fa-minus' aria-hidden='true'></i>"+Joomla.JText._("COM_JTICKETING_FILTERS_MORE_LBL")):jQuery("#mobiledisplayFilter").html("<i class='fa mr-5 fa-plus' aria-hidden='true'></i>"+Joomla.JText._("COM_JTICKETING_FILTERS_MORE_LBL")),"searchFilterInputBox"==spanId&&(jQuery(".events__search").toggleClass("active hide"),jQuery(".sort-result").hasClass("show")&&jQuery(".sort-result").removeClass("show").addClass("hide")),jQuery(".venueSearchli").toggleClass("active")},displayMobileFilter:function(){jQuery("#mobileFilter").toggleClass("hidden-xs")},calendarSubmit:function(day_filter,ele){if(jQuery("#jtwrap.tjBs5").length)var id="#filter_day_chosen";else var id="#filter_day_chzn";jQuery(window).width()<767&&(id="#filter_day");var daysArray=["today","tomorrow","weekend","thisweek","nextweek","thismonth","nextmonth"];""!=day_filter&&-1==jQuery.inArray(day_filter,daysArray)?(jQuery(id).daterangepicker({autoUpdateInput:!1,locale:{cancelLabel:"Clear"}}),jQuery(id).on("apply.daterangepicker",(function(ev,picker){jQuery(id).val(picker.startDate.format("YYYY-MM-DD")+" - "+picker.endDate.format("YYYY-MM-DD")),jQuery(id).css("display","block");var optionValue=jQuery(".drp-selected").text();jQuery("#filter_day option[value="+day_filter+"]").val(optionValue),jQuery("#filter_day").trigger("liszt:updated"),jQuery("#filter_day").trigger("chosen:updated"),ele.form.submit()})),jQuery(id).on("cancel.daterangepicker",(function(){jQuery(this).val("")}))):ele.form.submit()},resetCalendar:function(ele){jQuery("#filter_day").val(""),ele.form.submit()},localTimeEvents:function(startDate,endDate,event_id){var startDate=new Date(startDate.replace(/-/g,"/"));startDate=jtSite.event.formatDate(startDate);var endDate=new Date(endDate.replace(/-/g,"/"));endDate=jtSite.event.formatDate(endDate),1==guest&&(startDate+=" UTC",endDate+=" UTC"),startDate=new Date(startDate.replace(/-/g,"/")),startDate=jtSite.event.formatTime(startDate),endDate=new Date(endDate.replace(/-/g,"/")),endDate=jtSite.event.formatTime(endDate);var offset=(new Date).toString().match(/\(([A-Za-z\s].*)\)/)[1];jQuery(".time"+event_id).html("("+Joomla.JText._("COM_JTICKETING_YOUR_TIME")+startDate+" - "+endDate+" "+offset+")")}},venue:{initVenueJs:function(){jQuery(document).ready((function(){jtSite.venue.showHideVenueSeat()}))},onChangefun:function(){jQuery("#venue_gallary_filter").change((function(){var filterVal=document.getElementById("venue_gallary_filter").value;if("1"==filterVal){jQuery("#venue_videos").show(),jQuery("#venue_images").hide();const videoTitle=document.createElement("h5"),textNode=document.createTextNode(Joomla.JText._("COM_JTICKETING_GALLERY_VIDEO_TEXT"));videoTitle.appendChild(textNode),jQuery(".videosText").html(videoTitle),jQuery(".imagesText").hide()}else if("2"==filterVal){jQuery("#venue_videos").hide(),jQuery("#venue_images").show();const videoTitle=document.createElement("h5"),textNode=document.createTextNode(Joomla.JText._("COM_JTICKETING_GALLERY_IMAGE_TEXT"));videoTitle.appendChild(textNode),jQuery(".videosText").html(videoTitle),jQuery(".imagesText").hide()}else if("0"==filterVal){jQuery("#venue_videos").show(),jQuery("#venue_images").show();const videoTitle=document.createElement("h5"),textNode=document.createTextNode(Joomla.JText._("COM_JTICKETING_VENUE_VIDEOS"));videoTitle.appendChild(textNode),jQuery(".videosText").html(videoTitle),jQuery(".imagesText").show()}})).change()},showHideVenueSeat:function(){var seatCapacity;"0"==techjoomla.jQuery("#jform_seats_capacity").val()?techjoomla.jQuery(".capacityCountRow").removeClass("af-d-none"):techjoomla.jQuery(".capacityCountRow").addClass("af-d-none")}},venueForm:{initializeGMapSuggest:function(){input=document.getElementById("jform_address");var autocomplete=new google.maps.places.Autocomplete(input)},initVenueFormJs:function(){googleMapApiKey&&google.maps.event.addDomListener(window,"load",jtSite.venueForm.initializeGMapSuggest),jQuery(document).ready((function(){jQuery('input[name="jform[online]').click((function(){jtSite.venueForm.showOnlineOffline(jQuery('input[name="jform[online]"]:checked').val())})),jtSite.venueForm.showOnlineOffline(jQuery('input[name="jform[online]"]:checked').val()),jQuery("#jform_online_provider").change((function(){jtSite.venueForm.getPluginParams()})),(editId&&1==jQuery('input[name="jform[online]"]:checked').val()||1==jQuery('input[name="jform[online]"]:checked').val())&&jtSite.venueForm.getPluginParams();try{jQuery.each(mediaGallery,(function(key,media){tjMediaFile.previewFile(media,1)}))}catch(error){console.log(error)}getValue&&jQuery("#jform_online_provider").trigger("change"),jtSite.venueForm.venueCapacityCheck(),jQuery("#jform_seats_capacity").change((function(){jtSite.venueForm.venueCapacityCheck()}))}))},venueCapacityCheck:function(){0==jQuery("#jform_seats_capacity").val()?jQuery("#jform_capacity_count").addClass("required"):jQuery("#jform_capacity_count").removeClass("required")},showOnlineOffline:function(ifonline){1==ifonline?(jQuery("#jform_online_provider").closest(".online_provider_wrap").show(),jQuery("#provider_html").show(),jQuery("#jform_offline_provider").hide()):(jQuery("#jform_online_provider").closest(".online_provider_wrap").hide(),jQuery("#provider_html").hide(),jQuery("#jform_offline_provider").show())},venueFormSubmitButton:function(task){if("venueform.save"==task){var venue_name=jQuery('input[name="jform[jform_name]"]:checked').val(),api_username=jQuery('input[name="jform[api_username]"]:checked').val(),api_password=jQuery('input[name="jform[api_password]"]:checked').val(),host_url=jQuery('input[name="jform[host_url]"]:checked').val(),source_sco_id=jQuery('input[name="jform[source_sco_id]"]:checked').val(),onlines=jQuery('input[name="jform[online]"]:checked').val(),onlineProvider=jQuery("#jform_online_provider").val();if(editId&&"0"==onlines&&(jQuery("#api_username").val(""),jQuery("#api_password").val(""),jQuery("#host_url").val(""),jQuery("#source_sco_id").val("")),!document.formvalidator.isValid(document.getElementById("form-venue")))return!1;if(1==jQuery('input[name="jform[online]"]:checked').val()){if(!onlineProvider||"0"==onlineProvider)return alert(Joomla.JText._("COM_JTICKETING_VENUE_FORM_ONLINE_PROVIDER")),jQuery("#jform_online_provider").focus(),!1;let providerHtmlForm=document.createElement("form");for(fields=jQuery("#provider_html").find("input, textarea, select, fieldset"),i=0,l=fields.length;i<l;i++){let element=fields[i].cloneNode(!0);providerHtmlForm.appendChild(element)}if(!document.formvalidator.isValid(providerHtmlForm))return!1;jsonObj=[],jQuery("#provider_html input").each((function(){var id=jQuery(this).attr("id"),output=jQuery(this).val();item={},item.id=id,item.output=output;var source=jsonObj.push(item);jsonString=JSON.stringify(item),jQuery("#venue_params").val(jsonString)}))}else if(!jQuery("#jform_address").val()){var error_html="";return error_html+="<br />"+Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+Joomla.JText._("COM_JTICKETING_FORM_LBL_VENUE_ADDRESS"),Joomla.renderMessages({warning:[error_html]}),jQuery("#jform_address").focus(),!1}if(!jQuery("#form-venue #jform_name").val()){var error_html="";return error_html+="<br />"+Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+Joomla.JText._("COM_JTICKETING_FORM_LBL_VENUE_TITLE"),Joomla.renderMessages({warning:[error_html]}),!1}if(0==jQuery("#jform_seats_capacity").val()&&!jQuery("#jform_capacity_count").val())return!1;Joomla.submitform(task,document.getElementById("form-venue"))}"venueform.cancel"==task&&Joomla.submitform(task,document.getElementById("form-venue"))},getPluginParams:function(){var element=jQuery("#jform_online_provider").val(),parentDiv=jQuery("#form-venue");function initializeGoogleMap(){input=document.getElementById("jform_address");var autocomplete=new google.maps.places.Autocomplete(input)}parentDiv.addClass("isloading"),JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",datatype:"HTML",data:{async:"false",format:"",task:"venueform.getelementparams",element:element,venue_id:jQuery("#venue_id").val()}}).done((function(response){jQuery("#provider_html").html(response.data);var online=jQuery('input[name="jform[online]"]:checked').val();jQuery("#provider_html").css("display","none"),1==online&&(jQuery("#provider_html").css("display","block"),jQuery("#provider_html").trigger("subform-row-add",jQuery("#provider_html")))})).fail((function(content){return jQuery("#provider_html").hide(),Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_ORDER_RELATED_AJAX_FAIL_ERROR_MESSAGE")]}),!0})).always((function(){jQuery("html, body").animate({scrollTop:jQuery("#provider_html").offset().top},1500);for(var passwordSelection=document.getElementsByClassName("input-password-toggle"),i=0;i<passwordSelection.length;i++)!function(index){passwordSelection[index].addEventListener("click",(function(){"password"==jQuery(this).prev("input").attr("type")?jQuery(this).prev("input").attr("type","text"):jQuery(this).prev("input").attr("type","password")}))}(i);parentDiv.removeClass("isloading")})),googleMapApiKey&&google.maps.event.addDomListener(window,"load",initializeGoogleMap)},getLongitudeLatitude:function(){if(googleMapApiKey){var geocoder=new google.maps.Geocoder,address=jQuery("#jform_address").val();geocoder.geocode({address:address},(function(results,status){if(status==google.maps.GeocoderStatus.OK){var latitude=results[0].geometry.location.lat(),longitude=results[0].geometry.location.lng();jQuery("#jform_latitude").val(latitude),jQuery("#jform_longitude").val(longitude)}}))}},getCurrentLocation:function(){if(navigator.geolocation)navigator.geolocation.getCurrentPosition(showLocation);else{var address=Joomla.JText._("COM_JTICKETING_ADDRESS_NOT_FOUND"),lonlatval=Joomla.JText._("COM_JTICKETING_LONG_LAT_VAL");jQuery("#jform_address").val(address),jQuery("#jform_longitude").val(lonlatval),jQuery("#jform_latitude").val(lonlatval)}function showLocation(position){var latitude=position.coords.latitude,longitude=position.coords.longitude;jQuery.ajax({type:"POST",url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&task=venueform.getLocation",data:"latitude="+latitude+"&longitude="+longitude,dataType:"json",success:function(data){console.log(data);var address=data.location,longitude=data.longitude,latitude=data.latitude;data&&(jQuery("#jform_address").val(address),jQuery("#jform_longitude").val(longitude),jQuery("#jform_latitude").val(latitude))}})}}},event:{onlineMeetingUrl:function(thisVal,eventId){if(null==eventId)var eventId=jQuery("#event_id").val();var enterMeeting=jQuery("#jt-enterMeeting");enterMeeting.button("loading"),JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",data:{format:"",task:"event.onlineMeetingUrl",eventId:eventId,view:"event"}}).done((function(result){if(1==result.success){if(1==result.data)return void(top.location.href=Joomla.getOptions("system.paths").base+"/index.php?option=com_users&view=login");var win=window.open(result.data,"_blank");win?win.focus():(Joomla.renderMessages({notice:[Joomla.JText._("COM_JTICKETING_EVENTS_ENTER_MEETING_SITE_POPUPS")]}),jQuery("html, body").animate({scrollTop:0},"slow"))}else Joomla.renderMessages({error:[result.message]}),jQuery("html, body").animate({scrollTop:0},"slow")})).fail((function(content){Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_ORDER_RELATED_AJAX_FAIL_ERROR_MESSAGE")]}),jQuery("html, body").animate({scrollTop:0},"slow")})).always((function(){enterMeeting.button("reset")}))},meetingRecordingUrl:function(thisVal,eventId){if(null==eventId)var eventId=jQuery("#event_id").val();JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",data:{format:"",task:"event.meetingRecordingUrl",eventId:eventId,view:"event"}}).done((function(result){if(1==result.success){if(1==result.data)return void(top.location.href=Joomla.getOptions("system.paths").base+"/index.php?option=com_users&view=login");var win=window.open(result.data,"_blank");win?win.focus():(Joomla.renderMessages({notice:[Joomla.JText._("COM_JTICKETING_EVENTS_ENTER_MEETING_SITE_POPUPS")]}),jQuery("html, body").animate({scrollTop:0},"slow"))}else Joomla.renderMessages({error:[result.message]}),jQuery("html, body").animate({scrollTop:0},"slow")})).fail((function(content){Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_ORDER_RELATED_AJAX_FAIL_ERROR_MESSAGE")]}),jQuery("html, body").animate({scrollTop:0},"slow")})).always((function(){}))},initEventDetailJs:function(){jQuery(document).ready((function(){jQuery('[data-toggle="tooltip"]').tooltip(),jtCounter.jtCountDown("jt-countdown",startDate,endDate,currentDate),jtSite.event.onChangeGetOrderData(),1==guest&&(startDate=startDateUTC,endDate=endDateUTC),jtSite.event.localTime(startDate,endDate,guest),jQuery(".r-more").click((function(){var long_desc=jQuery(this).closest(".long_desc"),long_desc_extend=jQuery(".long_desc_extend");long_desc_extend.appendTo(".description"),jQuery(long_desc).hide(),jQuery(".r-more",long_desc).hide(),jQuery(long_desc_extend).show(),jQuery(".r-less",long_desc_extend).show()})),jQuery(".r-less").click((function(){var long_desc_extend=jQuery(".long_desc_extend"),long_desc=jQuery(".long_desc");jQuery(long_desc_extend).hide(),jQuery(".r-less",long_desc_extend).hide(),jQuery(".long_desc").show(),jQuery(".r-more",long_desc).show(),jQuery("html, body").animate({scrollTop:0},"slow")}))}))},viewMoreAttendee:function(){var eventId=document.getElementById("event_id").value;0==gbl_jticket_pro_pic&&(gbl_jticket_pro_pic=document.getElementById("attendee_pro_pic_index").value),techjoomla.jQuery.ajax({url:jtRootURL+"index.php?option=com_jticketing&task=event.viewMoreAttendee&tmpl=component",type:"POST",dataType:"json",data:{eventId:eventId,jticketing_index:gbl_jticket_pro_pic},success:function(data){gbl_jticket_pro_pic=data.jticketing_index,techjoomla.jQuery("#jticketing_attendee_pic ").append(data.records),(!data.records||attedee_count<=gbl_jticket_pro_pic)&&techjoomla.jQuery("#btn_showMorePic").hide()},error:function(data){console.log("error")}})},loadActivity:function(){jQuery(window).on("load",(function(){"0"==jQuery("#tj-activitystream .feed-item-cover").length&&jQuery(".todays-activity .feed-item").css("border-left","0px"),jQuery("#postactivity").attr("disabled",!0),jQuery("#activity-post-text").on("input",(function(){""==jQuery("#activity-post-text").val()?jQuery("#postactivity").attr("disabled",!0):jQuery("#postactivity").attr("disabled",!1);var textMax,textLength,text_remaining=jQuery("#activity-post-text").attr("maxlength")-jQuery("#activity-post-text").val().length;jQuery("#activity-post-text-length").html(text_remaining+" "+Joomla.JText._("COM_JTICKETING_POST_TEXT_ACTIVITY_REMAINING_TEXT_LIMIT"))}))}))},onChangefun:function(){jQuery("#gallary_filter").change((function(){var filterVal=document.getElementById("gallary_filter").value;if("1"==filterVal){jQuery("#videos").show(),jQuery("#images").hide();const videoTitle=document.createElement("h5"),textNode=document.createTextNode(Joomla.JText._("COM_JTICKETING_GALLERY_VIDEO_TEXT"));videoTitle.appendChild(textNode),jQuery(".videosText").html(videoTitle),jQuery(".imagesText").hide()}else if("2"==filterVal){jQuery("#videos").hide(),jQuery("#images").show();const videoTitle=document.createElement("h5"),textNode=document.createTextNode(Joomla.JText._("COM_JTICKETING_GALLERY_IMAGE_TEXT"));videoTitle.appendChild(textNode),jQuery(".videosText").html(videoTitle),jQuery(".imagesText").hide()}else if("0"==filterVal){jQuery("#videos").show(),jQuery("#images").show();const videoTitle=document.createElement("h5"),textNode=document.createTextNode(Joomla.JText._("COM_JTICKETING_EVENT_VIDEOS"));videoTitle.appendChild(textNode),jQuery(".videosText").html(videoTitle),jQuery(".imagesText").show()}})).change()},eventImgPopup:function(className){jQuery("."+className).magnificPopup({delegate:"a",type:"image",tLoading:"Loading image #%curr%...",mainClass:"mfp-img-mobile",gallery:{enabled:!0,navigateByImgClick:!0,preload:[0,1]},image:{tError:'<a href="%url%">The image #%curr%</a> could not be loaded.',titleSrc:function(item){return item.el.attr("title")+"<small></small>"}}})},onChangeGetOrderData:function(){jQuery("#event-graph-period").change((function(){var graphFilterVal=jQuery("#event-graph-period").val(),eventId=jQuery("#event_id").val(),ajaxcall;techjoomla.jQuery.ajax({type:"GET",url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&view=event&task=event.getEventOrderGrapgData&eventId="+eventId+"&filtervalue="+graphFilterVal,dataType:"json",error:function(data){console.log("error")}}).done((function(data){var graphid=document.getElementById("myevent_graph").getContext("2d"),total_eventOrderschart=new Chart(graphid,{type:"line",data:{labels:data.orderDate,datasets:[{label:data.totalOrdersAmount?data.totalOrdersAmount:0,data:data.orderAmount?data.orderAmount:0,backgroundColor:"rgba(203, 235, 230, 0.5)",borderColor:"rgba(55, 179, 142, 1)",lineTension:"0",borderWidth:"2",pointRadius:1,pointBackgroundColor:"rgba(55, 179, 142, 1)",pointBorderColor:"rgba(55, 179, 142, 1)",pointHoverBackgroundColor:"rgba(55, 179, 142, 1)",pointHoverBorderColor:"rgba(55, 179, 142, 1)"},{label:data.avgOrdersAmount?data.avgOrdersAmount:0,data:data.orderAvg?data.orderAvg:0,backgroundColor:"rgba(216, 225, 180, 1)",borderColor:"rgba(251, 214, 20, 0.90)",lineTension:"0",borderWidth:"2",pointRadius:1,pointBackgroundColor:"rgba(251, 214, 20, 0.90)",pointBorderColor:"rgba(251, 214, 20, 0.90)",pointHoverBackgroundColor:"rgba(251, 214, 20, 0.90)",pointHoverBorderColor:"rgba(251, 214, 20, 0.90)"}]}})}))})).change()},searchAttendee:function(){var input,filter,table,tr,td,i,cnt=0;for(filter=(input=document.getElementById("attendeeInput")).value.toUpperCase(),tr=(table=document.getElementById("eventAttender")).getElementsByTagName("tr"),i=0;i<tr.length;i++)(td=tr[i].getElementsByTagName("td")[1])&&(td.innerHTML.toUpperCase().indexOf(filter)>-1?(tr[i].style.display="",cnt+=1):tr[i].style.display="none");cnt<5?jQuery("#btn_showMorePic").hide():jQuery("#btn_showMorePic").show()},localTime:function(startDate,endDate,guest){var startDate=new Date(startDate.replace(/-/g,"/"));startDate=jtSite.event.formatDate(startDate);var endDate=new Date(endDate.replace(/-/g,"/"));endDate=jtSite.event.formatDate(endDate),1==guest&&(startDate+=" UTC",endDate+=" UTC"),startDate=new Date(startDate.replace(/-/g,"/")),startDate=jtSite.event.formatTime(startDate),endDate=new Date(endDate.replace(/-/g,"/")),endDate=jtSite.event.formatTime(endDate);var offset=(new Date).toString().match(/\(([A-Za-z\s].*)\)/)[1];jQuery(".time").html("("+Joomla.JText._("COM_JTICKETING_YOUR_TIME")+startDate+" - "+endDate+" "+offset+")")},formatDate:function(date){var hours=date.getHours(),minutes=date.getMinutes(),ampm=hours>=12?"pm":"am",strTime=(hours=(hours%=12)||12)+":"+(minutes=minutes<10?"0"+minutes:minutes)+" "+ampm;return date.getMonth()+1+"/"+date.getDate()+"/"+date.getFullYear()+" "+strTime},formatTime:function(date){var hours=date.getHours(),minutes=date.getMinutes(),ampm=hours>=12?"pm":"am",strTime;return(hours=(hours%=12)||12)+":"+(minutes=minutes<10?"0"+minutes:minutes)+" "+ampm}},order:{checkForAlpha:function(el){var i=0;for(i=0;i<el.value.length;i++)if(el.value.charCodeAt(i)>64&&el.value.charCodeAt(i)<92||el.value.charCodeAt(i)>96&&el.value.charCodeAt(i)<123){alert(Joomla.JText._("COM_JTICKETING_ENTER_NUMERICS")),el.value=el.value.substring(0,i);break}if(el.value<0&&alert(Joomla.JText._("COM_JTICKETING_ENTER_AMOUNT_GR_ZERO")),el.value%1!=0)return alert(Joomla.JText._("COM_JTICKETING_ENTER_AMOUNT_INT")),el.value=0,!1},validateSpecialChar:function(ele){var inputVal=jQuery(ele).val(),checkSpecialChars="`~!@#$%^&*()_=+[]{}|;:'\",<.>/?";for(i=0;i<checkSpecialChars.length;i++)if(inputVal.indexOf(checkSpecialChars[i])>-1)return jQuery(ele).val(""),alert(Joomla.JText._("COM_JTICKETING_CHECK_SPECIAL_CHARS")),!1},jtShowFilter:function(){jQuery("#jthorizontallayout").toggle()},jticketingGenerateState:function(countryId,SelectedValue,totalPrice){var country=jQuery("#"+countryId).val();if(null==country)return!1;JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&task=order.loadState&country="+country,type:"GET"}).done((function(result){!0===result.success&&jtSite.order.generateOption(result.data,countryId,SelectedValue)})).fail((function(){Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_ORDER_RELATED_AJAX_FAIL_ERROR_MESSAGE")]}),jQuery("html, body").animate({scrollTop:0},"slow")})),jQuery("select").trigger("chosen:updated"),jQuery("select").trigger("liszt:updated")},generateOption:function(data,countryId,SelectedValue){var country=jQuery("#"+countryId).val(),options,index,select,option;"country"==countryId&&(select=jQuery("#state"),defaultOption=Joomla.JText._("COM_JTICKETING_BILLIN_SELECT_STATE")),select.find("option").remove().end(),selected='selected="selected"';var op="<option "+selected+' value="">'+defaultOption+"</option>";if("country"==countryId&&jQuery("#state").append(op),null!=data)for(options=data,index=0;index<data.length;++index){selected="",name==SelectedValue&&(selected='selected="selected"');var opObj=data[index];selected="",opObj.id==SelectedValue&&(selected='selected="selected"');var op="<option "+selected+' value="'+opObj.id+'">'+opObj.region+"</option>";jQuery("#state").append(op)}jQuery("select").trigger("chosen:updated"),jQuery("select").trigger("liszt:updated")},selectAttendee:function(obj){var selectedAttendee=obj.value,hiddenAttendeeField;if(null==selectedAttendee||selectedAttendee<=0){var parentDiv=jQuery(obj).parent().parent().parent().parent().find("div"),allElements;return jQuery(parentDiv).find('input[id*="attendee_field_"],select[id*="attendee_field_"]').each((function(){var elementType;switch(jQuery(this).attr("type")){case"checkbox":case"radio":break;default:jQuery(this).val("")}})),!1}jQuery(obj).parent().parent().parent().find('input[id*="attendee_field_attendee_id"]').val(selectedAttendee),jQuery.ajax({url:jtRootURL+"?option=com_jticketing&format=json&task=order.selectAttendee&attendee_id="+selectedAttendee+"&tmpl=component&format=raw",type:"GET",dataType:"json",success:function(data){jQuery.each(data,(function(name,val){var el=jQuery(obj).parent().parent().parent().find('input[id*="attendee_field_'+name+'"],select[id*="attendee_field_'+name+'"]'),type;switch(el.attr("type")){case"checkbox":el.attr("checked","checked");break;case"radio":el.filter('[value="'+val+'"]').attr("checked","checked");break;default:el.val(val)}}))}})},verifyBookingID:function(){var bookId=document.getElementById("online_guest").value,url="index.php?option=com_jticketing&format=json&task=order.verifyBookingID";jQuery.ajax({url:url,type:"POST",async:!1,data:{book_id:bookId},dataType:"json",success:function(data){data.success?window.location.href=data.host_url:alert(Joomla.JText._("JT_TICKET_BOOKING_ID_VALIDATION"))}})},getRegistrationType:function(value){jQuery("input[name='registration_type']").val(value),"0"==value&&(jQuery(".business_detail").hide(),jQuery("#registration_type1").removeClass("btn-success active"),jQuery("#registration_type0").addClass("btn-success active"),jQuery("#business_name").removeClass("required")),"1"==value&&(jQuery(".business_detail").show(),jQuery("#registration_type1").addClass("btn-success active"),jQuery("#registration_type0").removeClass("btn-success active"),jQuery("#business_name").addClass("required"))},gatewayHtml:function(element,orderId){var prevButtonHtml='<button id="btnWizardPrev1" onclick="jQuery(\'#MyWizard\').wizard(\'previous\');" type="button" class="btn  btn-default  btn-prev pull-left" > <i class="icon-arrow-left" ></i>'+Joomla.JText._("COM_JTICKETING_PREV")+"</button>";"undefined"!=typeof intervalCounterDown&&clearInterval(intervalCounterDown),jQuery(".countdownDateInfo").html(""),jQuery.ajax({beforeSend:function(){jQuery("#jticketing-payHtmlDiv").addClass("isloading")},complete:function(){jQuery("#jticketing-payHtmlDiv").removeClass("isloading")},url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&task=payment.changegateway&gateways="+element+"&order_id="+orderId+"&tmpl=component",type:"POST",data:"",dataType:"json",success:function(result){if(!0===result.success){jQuery("#jticketing-payHtmlDiv").html(result.data),jQuery("#jticketing-payHtmlDiv div.form-actions").prepend(prevButtonHtml),jQuery('#jticketing-payHtmlDiv div.form-actions input[type="submit"]').addClass("pull-right"),jQuery('#jticketing-payHtmlDiv div.form-actions input[type="submit"]').addClass("paymentButton"),1===ga_ec_analytics&&jQuery(".paymentButton").click((function(){var stepId=4;1===track_attendee_step&&(stepId=5),jtSite.order.addEcTrackingData(orderId,stepId)}));var countdownDate=new Date;countdownDate.setMinutes(countdownDate.getMinutes()+Number(intervalCounterDownTime)),intervalCounterDown=setInterval((function(){var now=(new Date).getTime(),distance=countdownDate-now,minutes=Math.floor(distance%36e5/6e4),seconds=Math.floor(distance%6e4/1e3),output=Joomla.JText._("COM_JTICKETING_COMPLETE_PAYMENT_WITHIN")+" <b>"+minutes+"m "+seconds+"s </b>";jQuery(".countdownDateInfo").html(output),distance<0&&(clearInterval(intervalCounterDown),jQuery(".countdownDateInfo").html("Expired"),alert(Joomla.JText._("COM_JTICKETING_TIME_EXPIRED_RETRY_PAYMENT")),location.reload(!0))}),1e3)}else alert(result.message)}})},jtLogin:function(){jQuery.ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&format=json&task=order.loginValidate&tmpl=component",type:"post",data:jQuery("#user-info-tab #login :input"),dataType:"json",beforeSend:function(){jQuery("#button-login").attr("disabled",!0),jQuery("#button-login").after('<span class="wait">&nbsp;Loading..</span>')},complete:function(){jQuery("#button-login").attr("disabled",!1),jQuery(".wait").remove()},success:function(json){jQuery(".warning, .j2error").remove(),json.error?(jQuery("#login").prepend('<div class="warning danger" >'+json.error.warning+'<button data-dismiss="alert" class="close" type="button">×</button></div>'),jQuery(".warning").fadeIn("slow")):json.redirect&&!json.redirect_invoice_view?(jtSite.order.updateBillingDetails(),jQuery("#btnWizardNext").show()):json.redirect_invoice_view&&(document.location=json.redirect_invoice_view)},error:function(xhr,ajaxOptions,thrownError){}})},updateBillingDetails:function(){jQuery("#btnWizardNext").removeAttr("disabled"),jQuery.ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&format=json&task=order.getUpdatedBillingInfo&tmpl=component",type:"post",data:jQuery("#user-info-tab #login :input"),dataType:"json",beforeSend:function(){},complete:function(){},success:function(json){json.error||json.billing_html&&(jQuery("#billing-info").html(json.billing_html),jtSite.order.jticketingGenerateState("country","",""),jQuery("#billing_info_data").show())},error:function(xhr,ajaxOptions,thrownError){}})},paymentInit:function(){jQuery(document).ready((function(){1==count&&jtSite.order.gatewayHtml(gateWayName,orderId)}))},addEcTrackingData:function(orderId,stepId){"undefined"!=typeof tjanalytics&&JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&task=order.getEcTrackingData&orderId="+orderId+"&stepId="+stepId,type:"GET"}).done((function(response){tjanalytics.ga.addProduct(response.data),stepId>0?tjanalytics.ga.setAction(response.data[0]):tjanalytics.ga.setTransaction(response.data[0])})).fail((function(){return!0}))},validateAttendeeName:function(){var regexForEmail=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;jQuery("#attendeeCheckout").click((function(){for(var i=0;;){var mob="#attendee_field_3_";if(mob=mob.concat(i),!jQuery(mob).length)break;if(jQuery(mob).length&&""!=jQuery(mob).val()&&!regexForAttendeeMob.test(jQuery(mob).val())){var error_html=Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+Joomla.JText._("COM_JTICKETING_INVALID_ATTENDEE_MOB")+" "+(i+1);return Joomla.renderMessages({error:[error_html]}),jQuery("html, body").animate({scrollTop:0},"slow"),!1}var email="#attendee_field_4_";if(email=email.concat(i),jQuery(email).length&&""!=jQuery(email).val()&&!regexForEmail.test(jQuery(email).val())){var error_html=Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+Joomla.JText._("COM_JTICKETING_INVALID_ATTENDEE_EMAIL")+" "+(i+1);return Joomla.renderMessages({error:[error_html]}),jQuery("html, body").animate({scrollTop:0},"slow"),!1}i++}}))},hideEmailField:function(){jQuery("#ticketToBuyer").on("click",(function(){jQuery(".emailValidation").addClass("af-d-none"),jQuery(".emailValidation").parent().addClass("af-d-none"),jQuery(".emailValidation").removeClass("required"),jQuery(".emailValidation").removeAttr("required")})),jQuery("#ticketToAttendee").on("click",(function(){jQuery(".emailValidation").removeClass("af-d-none"),jQuery(".emailValidation").parent().removeClass("af-d-none"),jQuery(".emailValidation").addClass("required"),jQuery(".emailValidation").attr("required")}))}},orders:{initOrdersJs:function(){jQuery(document).ready((function(){jQuery(".jt_selectbox").attr("data-chosen","com_jticketing"),jQuery("input[name='gateways']").change((function(){var paymentGeteway=jQuery("input[name='gateways']:checked").val();jQuery("#html-container").empty().html("Loading..."),jQuery.ajax({url:jtRootURL+"index.php?option=com_jticketing&tmpl=component&task=orders.retryPayment&order="+orderID+"&gateway_name="+paymentGeteway,type:"GET",dataType:"json",success:function(response){jQuery("#html-container").removeClass("ajax-loading").html(response)}})}))})),Joomla.submitbutton=function(task){"cancel"==task&&Joomla.submitform(task,document.getElementById("adminForm"))}},selectStatusOrder:function(appid,processor,ele){document.getElementById("order_id").value=appid,document.getElementById("payment_status").value=ele.value,document.getElementById("processor").value=processor;var selInd=ele.selectedIndex,status=ele.options[selInd].value,orderStatusvalue="",task="orders.save";if("RF"===status&&(orderStatusvalue="REFUND"),"E"===status&&(orderStatusvalue="FAILED"),"D"===status&&(orderStatusvalue="DECLINE"),"CRV"===status&&(orderStatusvalue="CANCEL_REVERSED"),"RV"===status&&(orderStatusvalue="REVERSED"),"RF"===status||"E"===status||"D"===status||"CRV"===status||"RV"===status){var orderStatusLanguageConstant="COM_JTICKETING_ORDER_STATUS_"+orderStatusvalue,orderStatusMessage=Joomla.JText._("COM_JTICKETING_ORDER_STATUS_MESSAGE1")+Joomla.JText._(orderStatusLanguageConstant)+Joomla.JText._("COM_JTICKETING_ORDER_STATUS_MESSAGE2"),confirmation;if(!0!==confirm(orderStatusMessage)){var oldStatus=jQuery(ele).data("oldvalue");return jQuery(ele).val(oldStatus),jQuery(ele).trigger("liszt:updated"),jQuery(ele).trigger("chosen:updated"),!1}Joomla.submitform(task,document.getElementById("adminForm"))}else Joomla.submitform(task,document.getElementById("adminForm"))},printDiv:function(){var printContents=document.getElementById("printDiv").innerHTML,originalContents=document.body.innerHTML;document.body.innerHTML=printContents,window.print(),document.body.innerHTML=originalContents},showPaymentGetways:function(){return"none"==document.getElementById("gatewaysContent").style.display&&(document.getElementById("gatewaysContent").style.display="block"),!1}},eventform:{initEventJs:function(){jQuery(window).on("load",(function(){jQuery("#jform_startdate, #jform_enddate, .time-hours , .time-minutes").on("change, blur",(function(){0===jQuery("#jform_venue")[0].length&&jtSite.eventform.venueDisplay()})),jtSite.eventform.showTicketCapacity()})),jQuery(document).ready((function(){var radioValue=jQuery("input[name='jform[online_events]']:checked").val(),selectedVenueDetails="";jQuery("#attendeefields .subform-repeatable-wrapper").length&&jQuery("#attendeefields .subform-repeatable-wrapper .subform-repeatable .btn-toolbar.hidden:first").removeClass("hidden");var id=jQuery("input[name='jform[id]']").val(),venueDisplayPromise=jtSite.eventform.venueDisplay();jtSite.eventform.existingEvents(),jtSite.eventform.selectExistingEventOnload(),venueDisplayPromise.then((function(){jtSite.eventform.showLocation()})),jQuery("input[name='jform[online_events]']").change((function(){jtSite.eventform.venueDisplay(),jtSite.eventform.existingEvents()})),jQuery("#jform_venue").change((function(){jtSite.eventform.showLocation()})),jQuery(".venueCheck").change((function(){jtSite.eventform.selectExistingEvent(),jtSite.eventform.showTicketCapacity()})),jQuery(".existingEvent").change((function(){jtSite.eventform.existingEventSelection()})),jQuery(".group-add").on("click",(function(){setTimeout((function(){jtSite.eventform.showTicketAvailability()}),150)})),jQuery.each(mediaGallery,(function(key,media){tjMediaFile.previewFile(media,1)})),jQuery('input[type=radio][name="jform[venuechoice]"]').on("click",(function(){var venuechoicestatus;"existing"==jQuery('input[type=radio][name="jform[venuechoice]"]:checked').val()?jQuery("#existingEvent").show():jQuery("#existingEvent").hide()})),jQuery(document).on("subform-row-add",(function(event,row){jQuery("input.price").change((function(){var returnValue=jtSite.eventform.getRoundedValue(this.value);if(returnValue){jQuery(this.id).focus();var error_html="";return error_html+=Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+returnValue,Joomla.renderMessages({warning:[error_html]}),!1}}))})),jQuery("input.price").change((function(){var returnValue=jtSite.eventform.getRoundedValue(this.value);if(returnValue){jQuery(this.id).focus();var error_html="";return error_html+=Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+returnValue,Joomla.renderMessages({warning:[error_html]}),!1}})),jQuery("#jform_location").change((function(){if(googleMapLink){var geocoder=new google.maps.Geocoder,address=jQuery("#jform_location").val();geocoder.geocode({address:address},(function(results,status){if(status==google.maps.GeocoderStatus.OK){var latitude=results[0].geometry.location.lat(),longitude=results[0].geometry.location.lng();jQuery("#jform_latitude").val(latitude),jQuery("#jform_longitude").val(longitude)}}))}})),jtSite.eventform.displayNotices(ticketAccessState),jQuery(document).on("subform-row-add",(function(event,row){jtSite.eventform.displayNotices(ticketAccessState)}))})),Joomla.submitbutton=function(task){jQuery("#eventform-save").addClass("disabled"),"eventform.cancel"==task&&(jQuery("#eventform-save").removeClass("disabled"),Joomla.submitform(task,document.getElementById("adminForm")));var returnData=1;if(!document.formvalidator.isValid(document.getElementById("adminForm")))return jQuery("html, body").animate({scrollTop:jQuery("#system-message-container").position().top}),jQuery("#eventform-save").removeClass("disabled"),!1;var eventStartDate=document.getElementById("jform_startdate").value,eventEndDate=document.getElementById("jform_enddate").value,compareStartDate=new Date(eventStartDate),compareEndDate=new Date(eventEndDate),eventBookingStartDate=document.getElementById("jform_booking_start_date").value,eventBookingEndDate=document.getElementById("jform_booking_end_date").value,compareBookingStartDate=new Date(eventBookingStartDate),compareBookingEndDate=new Date(eventBookingEndDate);if(("eventform.save"==task||"eventform.save2new"==task||"eventform.apply"==task)&&eventId){var oldEventStartDateInFormat=Number(new Date(oldEventStartDate)),eventStartDateInFormat=Number(new Date(eventStartDate)),oldEventEndDateInFormat=Number(new Date(oldEventEndDate)),eventEndDateInFormat=Number(new Date(eventEndDate)),result;if(oldEventStartDateInFormat!=eventStartDateInFormat||oldEventEndDateInFormat!=eventEndDateInFormat)if(1!=confirm(Joomla.JText._("COM_JTICKETING_SAVE_THE_EVENT_CHANGED_DATES")))return jQuery("#eventform-save").removeClass("disabled"),!1}var value=new Array;jQuery(".price").each((function(){let price=jQuery(this).val().isInteger?jQuery(this).val():Math.round(100*jQuery(this).val())/100;returnValue=jtSite.eventform.getRoundedValue(price),returnValue&&value.push(returnValue)}));var errorCode=new Array;if(jQuery(".ticket-end-date").each((function(){var ticketEndDt=new Date(jQuery(this).val());"Invalid Date"!=ticketEndDt&&(""==eventBookingEndDate&&ticketEndDt>compareEndDate?(jQuery(this.id).focus(),errorCode.push(Joomla.JText._("COM_JTICKETING_TICKET_END_DATE_GREATER_EVENT_END_DATE_ERROR"))):"Invalid Date"!=compareBookingEndDate&&ticketEndDt>compareBookingEndDate&&(jQuery(this.id).focus(),errorCode.push(Joomla.JText._("COM_JTICKETING_TICKET_END_DATE_GREATER_BOOKING_END_DATE_ERROR"))),""==eventBookingStartDate&&ticketEndDt<new Date?(jQuery(this.id).focus(),errorCode.push(Joomla.JText._("COM_JTICKETING_TICKET_END_DATE_LESS_EVENT_MODIFICATION_DATE_ERROR"))):"Invalid Date"!=compareBookingStartDate&&ticketEndDt<compareBookingStartDate&&(jQuery(this.id).focus(),errorCode.push(Joomla.JText._("COM_JTICKETING_TICKET_END_DATE_LESS_BOOKING_START_DATE_ERROR"))))})),eventStartDate&&eventBookingStartDate){var eventStartDateTime=new Date(eventStartDate),eventBookingStartDateTime;new Date(eventBookingStartDate)>eventStartDateTime&&(jQuery("jform_startdate").focus(),errorCode.push(Joomla.JText._("COM_JTICKETING_BOOKING_START_DATE_WITH_EVENT_DATE_ERROR")))}if("eventform.save"==task){if(selectedVenueDetails){var totalEnteredSeats=0;if(techjoomla.jQuery("input.avail").each((function(){console.log(parseInt(techjoomla.jQuery(this).val())),totalEnteredSeats+=parseInt(techjoomla.jQuery(this).val())})),totalEnteredSeats>selectedVenueDetails.capacity_count)return alert(Joomla.JText._("COM_JTICKETING_VENUE_CAPACITY_ERROR")),jQuery("#eventform-save").removeClass("disabled"),!1}if(jQuery("#jform_start_number_for_event_level_sequence").length){const alphanumericRegex=/^[a-zA-Z0-9]+$/;if(jQuery("#jform_start_number_for_event_level_sequence").val()&&!alphanumericRegex.test(jQuery("#jform_start_number_for_event_level_sequence").val())){var error_html="";return jQuery("#eventform-save").removeClass("disabled"),error_html+=Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+": "+Joomla.JText._("COM_JTICKETING_START_NUMBER_FOR_EVENT_LEVEL_SEQUENCE"),Joomla.renderMessages({warning:[error_html]}),void jQuery("#jform_start_number_for_event_level_sequence").focus()}for(var i=0;;){var allowSequence="jform[tickettypes][tickettypes"+i+"][allow_ticket_level_sequence]";if(!jQuery('input[name="'+allowSequence+'"]:checked').length)break;if(jQuery('input[name="'+allowSequence+'"]:checked').val()){var sequenceId="#jform_tickettypes__tickettypes"+i+"__start_number_for_sequence";if(jQuery(sequenceId).length&&jQuery(sequenceId).val()&&!alphanumericRegex.test(jQuery(sequenceId).val())){var error_html="";return jQuery("#eventform-save").removeClass("disabled"),error_html+=Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+": "+Joomla.JText._("COM_JTICKETING_START_NUMBER_FOR_SEQUENCE"),Joomla.renderMessages({warning:[error_html]}),void jQuery(sequenceId).focus()}}i++}}if(1==tncForCreateEvent&&!1===document.getElementById("accept_privacy_term").checked)return alert(Joomla.JText._("COM_JTICKETING_PRIVACY_TERMS_AND_CONDITIONS_ERROR")),jQuery("#eventform-save").removeClass("disabled"),!1;if(0!=errorCode.length){var error_html="";for(index=0;index<errorCode.length;++index)error_html+=errorCode[index]+"<br>";return Joomla.renderMessages({warning:[error_html]}),!1}if(0!=value.length)jQuery(value).each((function(){var error_html="";return error_html+=Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+value,Joomla.renderMessages({warning:[error_html]}),jQuery("#eventform-save").removeClass("disabled"),!1}));else if(compareEndDate<=compareStartDate){var error_html="";error_html+="<br />"+Joomla.JText._("COM_JTICKETING_FORM_LBL_EVENT_DATE_ERROR"),Joomla.renderMessages({warning:[error_html]})}else if("Invalid Date"!=compareBookingStartDate&&"Invalid Date"!=compareBookingEndDate&&compareBookingEndDate<=compareBookingStartDate){var error_html="";error_html+="<br />"+Joomla.JText._("COM_JTICKETING_FORM_LBL_EVENT_BOOKING_DATE_ERROR"),Joomla.renderMessages({warning:[error_html]})}else if("Invalid Date"!=compareBookingEndDate&&compareEndDate<compareBookingEndDate){var error_html="";error_html+="<br />"+Joomla.JText._("COM_JTICKETING_FORM_LBL_EVENT_BOOKING_EVENT_END_ERROR"),Joomla.renderMessages({warning:[error_html]})}else{for(var i=0;;){var unlimited="#jform_tickettypes__tickettypes"+i+"__unlimited_seats",flag=0,available="#jform_tickettypes__tickettypes"+i+"__available";if(!jQuery(unlimited).length)break;if(0==jQuery(unlimited).val()&&(jQuery(available).val()<=0||!/^\d+$/.test(jQuery(available).val()))){flag=1;var error_html="";error_html=Joomla.JText._("COM_JTICKETING_ERROR")+"<br>"+Joomla.JText._("COM_JTICKETING_INVALID_SEAT_COUNT_ERROR"),Joomla.renderMessages({warning:[error_html]}),jQuery(available).css("border-color","red"),jQuery(available).focus();break}i++}var validData;jQuery("#tickettypes .subform-repeatable-group").each((function(key){var thisSubForm=jQuery(this);if((0==thisSubForm.find("select.unlimited-seats").val()||"0"==thisSubForm.find("select.unlimited-seats").val())&&!thisSubForm.find("input.avail").val()){var alertError=Joomla.JText._("COM_JTICKETING_ENTER_VALID_SEAT_COUNT_FOR_TICKET")+" "+thisSubForm.find("input.title").val();alert(alertError),returnData=0}})),jQuery("#accept_privacy_term").length&&1!=jQuery("#accept_privacy_term").prop("checked")&&(alert(Joomla.JText._("COM_JTICKETING_PRIVACY_TERMS_AND_CONDITIONS_ERROR")),returnData=0),1==document.formvalidator.isValid(document.getElementById("adminForm"))&&0==flag&&Joomla.submitform(task,document.getElementById("adminForm")),1==returnData&&Joomla.submitform(task,document.getElementById("adminForm"))}}else Joomla.submitform(task,document.getElementById("adminForm"));jQuery("#eventform-save").removeClass("disabled")}},getRoundedValue:function(value){var errorMsg="";return jQuery.ajax({type:"POST",dataType:"json",data:{price:value},async:!1,url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&format=json&task=eventform.getRoundedValue&price="+value,success:function(data){if(data.data==value)return value;roundedPrice=data.data,errorMsg=Joomla.JText._("COM_JTICKETING_VALIDATE_ROUNDED_PRICE").concat(roundedPrice)}}),errorMsg},showLocation:function(){var venue=parseInt(jQuery("#jform_venue").val()),onlineOfflineVenues=jQuery("input[name='jform[online_events]']:checked").val();if(0==parseInt(enableOnlineVenues))selectedVenue>0&&0===venue?(jQuery("#event-location").show(),jQuery("#jform_location").prop("required",!0),jQuery("#jform_location").addClass("required")):selectedVenue>0?(jQuery("#event-location").hide(),jQuery("#jform_location").prop("required",!1),jQuery("#jform_location").removeClass("required")):0!=venue&&venue?(jQuery("#event-location").hide(),jQuery("#jform_location").prop("required",!1),jQuery("#jform_location").removeClass("required")):(jQuery("#event-location").show(),jQuery("#jform_location").prop("required",!0),jQuery("#jform_location").addClass("required"));else if(selectedVenue>0&&!venue)jQuery("#event-location").show(),jQuery("#jform_location").prop("required",!0),jQuery("#jform_location").addClass("required");else if(0==venue&&"0"===onlineOfflineVenues)jQuery("#event-location").show(),jQuery("#jform_location").prop("required",!0),jQuery("#jform_location").addClass("required");else if(venue||"0"!==onlineOfflineVenues)jQuery("#event-location").hide(),jQuery("#jform_location").prop("required",!1),jQuery("#jform_location").removeClass("required");else{var venuevalue=jQuery("#foorm_venue").val();jQuery("#event-location").show(),jQuery("#jform_location").prop("required",!0),jQuery("#jform_location").addClass("required")}},venueDisplay:function(){return new Promise((function(resolve,reject){var radioValue=jQuery("input[name='jform[online_events]']:checked").val(),eventStartDate=document.getElementById("jform_startdate").value,eventEndDate=document.getElementById("jform_enddate").value;if(1==silentVendor)var created_by=jQuery("input[name='jform[created_by]']").val();var onlineOfflineVenues=jQuery("input[name='jform[online_events]']:checked").val(),selectedVenue=jQuery("#jform_venue").val();"1"==onlineOfflineVenues?(jQuery("#event-location").hide(),jQuery("#venuechoice_id").show(),jQuery("#existingEvent").show()):(jQuery("#venuechoice_id").hide(),jQuery("#existingEvent").hide());var userObject={};userObject.radioValue=radioValue,userObject.eventStartTime=eventStartDate,userObject.eventEndTime=eventEndDate,userObject.silentVendor=silentVendor,userObject.eventId=eventId,userObject.venueId=venueId,0==silentVendor?userObject.vendor_id=vendor_id:userObject.created_by=created_by,jQuery("#jform_venue, .chzn-results").empty(),JSON.stringify(userObject),jQuery.ajax({type:"POST",data:userObject,dataType:"json",url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&format=json&task=eventform.getVenueList",success:function(data){if(""==data&&0==eventId&&1==radioValue){jQuery("#jform_venue").prop("disabled",!0);var op="<option value='0' selected='selected'>"+Joomla.JText._("COM_JTICKETING_NO_ONLINE_VENUE_ERROR")+"</option>";jQuery("#jform_venue").append(op),jQuery("#jform_venue").trigger("liszt:updated"),jQuery("#jform_venue").trigger("chosen:updated");var error_html="";error_html+="<br />"+Joomla.JText._("COM_JTICKETING_NO_VENUE_ERROR_MSG"),Joomla.renderMessages({warning:[error_html]})}else if(0!=eventId){var onlineOfflineVenues;1==jQuery("input[name='jform[online_events]']:checked").val()&&jQuery("#jform_venue").prop("disabled",!0),0==venueId&&(jQuery("#jform_venue, .chzn-results").empty(),venueName=Joomla.JText._("COM_JTICKETING_CUSTOM_LOCATION"));var op="<option value='"+venueId+"' selected='selected'>"+venueName+" </option>";for(jQuery("#jform_venue").append(op),jQuery("#jform_venue").trigger("liszt:updated"),jQuery("#jform_venue").trigger("chosen:updated"),index=0;index<data.length;++index){var op="<option value='"+data[index].value+"' > "+data[index].text+"</option>";jQuery("#jform_venue").append(op),jQuery("#jform_venue").trigger("liszt:updated"),jQuery("#jform_venue").trigger("chosen:updated")}}else{jQuery("#jform_venue").prop("disabled",!1);var op="<option value='' selected='selected'>"+Joomla.JText._("COM_JTICKETING_FORM_EVENT_DEFAULT_VENUE_OPTION")+"</option>";for(jQuery("#jform_venue").append(op),jQuery("#jform_venue").trigger("liszt:updated"),jQuery("#jform_venue").trigger("chosen:updated"),index=0;index<data.length;++index){var op="<option value='"+data[index].value+"' > "+data[index].text+"</option>";jQuery("#jform_venue").append(op),jQuery("#jform_venue").trigger("liszt:updated"),jQuery("#jform_venue").trigger("chosen:updated")}}resolve()}})}))},ConvertTimeformat:function(date,hours,minutes,amPm){hours=parseInt(hours),"PM"==amPm&&hours<12&&(hours+=12),"AM"==amPm&&12==hours&&(hours-=12),hours<10&&(hours="0"+hours),(minutes=parseInt(minutes))<10&&(minutes="0"+minutes);var time,utcDateTime=new Date(date+" "+hours+":"+minutes+":00").toISOString(),formattedUtcDateTime;return(utcDateTime=utcDateTime.substring(0,utcDateTime.length-5)).replace("T"," ")},existingEvents:function(){var radioValue=jQuery("input[name='jform[online_events]']:checked").val(),existingEventChoice;"new"==jQuery("input[name='jform[venuechoice]']:checked").val()&&"1"==radioValue?jQuery("#form_existingEvent").hide():jQuery("#form_existingEvent").show()},selectExistingEvent:function(){var venueId=document.getElementById("jform_venue").value,venuestatus=jQuery('input[type=radio][name="jform[online_events]"]:checked').val();jQuery("#jform_existing_event option").remove();var eventDropdown=jQuery("#jform_existing_event"),op="<option value='' selected='selected'>"+Joomla.JText._("COM_JTICKETING_FORM_SELECT_EXISTING_EVENT_OPTION")+"</option>";eventDropdown.append(op),eventDropdown.trigger("liszt:updated"),eventDropdown.trigger("chosen:updated"),"0"!=venueId&&"1"==venuestatus&&JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",data:{task:"eventform.getAllMeetings",venueId:venueId}}).done((function(result){if(!0===result.success){var eventList=result.data;null!=eventList&&Array.isArray(eventList)&&eventList.forEach((function(event){op=existing_url==event.id?"<option value='"+event.id+"' selected='selected'>"+event.title+" ("+event.start_time+")</option>":"<option value='"+event.id+"' >"+event.title+" ("+event.start_time+")</option>",eventDropdown.append(op)}))}})).fail((function(content){Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_EVENT_RELATED_AJAX_FAIL_ERROR_MESSAGE")]})})).always((function(){eventDropdown.trigger("liszt:updated"),eventDropdown.trigger("chosen:updated")}))},selectExistingEventOnload:function(){if(!existing_url){var venuestatus=jQuery('input[type=radio][name="jform[online_events]"]:checked').val();jQuery("#jform_existing_event option").remove();var eventDropdown=jQuery("#jform_existing_event"),op="<option value='' selected='selected'>"+Joomla.JText._("COM_JTICKETING_FORM_SELECT_EXISTING_EVENT_OPTION")+"</option>";eventDropdown.append(op),eventDropdown.trigger("liszt:updated"),eventDropdown.trigger("chosen:updated"),"0"!=venueId&&"1"==venuestatus&&JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",data:{task:"eventform.getAllMeetings",venueId:venueId}}).done((function(result){if(!0===result.success){var eventList=result.data;null!=eventList&&Array.isArray(eventList)&&eventList.forEach((function(event){op=existing_url==event.id?"<option value='"+event.id+"' selected='selected'>"+event.title+" ("+event.start_time+")</option>":"<option value='"+event.id+"' >"+event.title+" ("+event.start_time+")</option>",eventDropdown.append(op)}))}})).fail((function(content){Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_EVENT_RELATED_AJAX_FAIL_ERROR_MESSAGE")]})})).always((function(){eventDropdown.trigger("liszt:updated"),eventDropdown.trigger("chosen:updated")}))}},existingEventSelection:function(){var radioValue=jQuery("input[name='jform[online_events]']:checked").val(),existingEventChoice;"new"==jQuery("input[name='jform[venuechoice]']:checked").val()&&"1"==radioValue?jQuery("#form_existingEvent").hide():jQuery("#form_existingEvent").show()},displayNotices:function(access){"exclude"==access?jQuery(".accessNote").html(Joomla.JText._("COM_JTICKETING_TICKET_ACCESS_EXCLUDE")):jQuery(".accessNote").html(Joomla.JText._("COM_JTICKETING_TICKET_ACCESS_INCLUDE"))},showTicketCapacity:function(){var venue=parseInt(jQuery("#jform_venue").val());if(techjoomla.jQuery(".ticketCapacityNote").addClass("af-d-none"),techjoomla.jQuery(".unlimited-seats option[value='1']").prop("disabled",!1),jQuery(".unlimited-seats").trigger("liszt:updated"),jQuery(".unlimited-seats").trigger("chosen:updated"),venue){var requestObject={};requestObject.venue=venue,JSON.stringify(requestObject),jQuery.ajax({type:"POST",dataType:"json",data:requestObject,url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&format=json&task=venueform.getCapacity",success:function(result){result&&(result.data&&0==result.data.seats_capacity?(techjoomla.jQuery(".unlimited-seats").each((function(){techjoomla.jQuery(this).val()||techjoomla.jQuery(this).val("")})),techjoomla.jQuery(".unlimited-seats option[value='1']").prop("disabled",!0),jQuery(".unlimited-seats").trigger("liszt:updated"),jQuery(".unlimited-seats").trigger("chosen:updated"),techjoomla.jQuery(".ticketCapacityNote").removeClass("af-d-none"),techjoomla.jQuery(".ticketCapacityNote").html(Joomla.JText._("COM_JTICKETING_TICKET_CAPACITY_ALERT")+result.data.capacity_count),selectedVenueDetails=result.data):(1==result.data&&alert(result.message),selectedVenueDetails=""))}})}else selectedVenueDetails=""},showTicketAvailability:function(){var venue;(jQuery("#jform_venue").val()?parseInt(jQuery("#jform_venue").val()):0)&&selectedVenueDetails&&(techjoomla.jQuery(".unlimited-seats").each((function(){techjoomla.jQuery(this).val()||techjoomla.jQuery(this).val("")})),techjoomla.jQuery(".unlimited-seats option[value='1']").prop("disabled",!0),jQuery(".unlimited-seats").trigger("liszt:updated"),jQuery(".unlimited-seats").trigger("chosen:updated"),techjoomla.jQuery(".ticketCapacityNote").removeClass("af-d-none"),techjoomla.jQuery(".ticketCapacityNote").html(Joomla.JText._("COM_JTICKETING_TICKET_CAPACITY_ALERT")+selectedVenueDetails.capacity_count))}},couponform:{initCouponFormJs:function(){jQuery(document).ready((function(){jQuery("#jform_value").change((function(){validation.checkForZeroAndAlpha(this,"46",Joomla.JText._("COM_JTICKETING_ENTER_NUMERICS")),jQuery("#couponform #jform_val_type").length&&"1"==jQuery("#couponform #jform_val_type").val()&&jQuery("#jform_value").val()&&parseInt(jQuery("#jform_value").val())>100&&(alert(Joomla.JText._("COM_JTICKETING_COUPON_PERCENTAGE_ERROR")),jQuery("#jform_value").val(""))})),jQuery("#couponform #jform_val_type").change((function(){jQuery("#couponform #jform_val_type").length&&"1"==jQuery("#couponform #jform_val_type").val()&&jQuery("#jform_value").val()&&parseInt(jQuery("#jform_value").val())>100&&(alert(Joomla.JText._("COM_JTICKETING_COUPON_PERCENTAGE_ERROR")),jQuery("#jform_value").val(""))})),jQuery("#jform_limit").change((function(){validation.checkForZeroAndAlpha(this,"46",Joomla.JText._("COM_JTICKETING_ENTER_NUMERICS"))})),jQuery("#jform_max_per_user").change((function(){validation.checkForZeroAndAlpha(this,"46",Joomla.JText._("COM_JTICKETING_ENTER_NUMERICS"))}))}))},couponSubmitButton:function(task){if(jQuery("#couponform #jform_val_type").length&&"1"==jQuery("#couponform #jform_val_type").val()&&jQuery("#jform_value").val()&&parseInt(jQuery("#jform_value").val())>100)return alert(Joomla.JText._("COM_JTICKETING_COUPON_PERCENTAGE_ERROR")),jQuery("#jform_value").val(""),!1;"couponform.cancel"==task?Joomla.submitform(task,document.getElementById("coupon-form")):"couponform.cancel"!=task&&document.formvalidator.isValid(document.getElementById("coupon-form"))&&Joomla.submitform(task,document.getElementById("coupon-form"))}},coupons:{couponsSubmitData:function(task){var r;if("coupons.delete"==task&&!0!==confirm(Joomla.JText._("COM_JTICKETING_ARE_YOU_SURE_YOU_TO_DELETE_THE_COUPON")))return;Joomla.submitform(task)}},myEvents:{myEventsSubmitData:function(task){"eventform.add"!=task&&0==document.adminForm.boxchecked.value?alert(Joomla.Text._("TJTOOLBAR_NO_SELECT_MSG")):Joomla.submitform(task)}}},jtAdmin={event:{initEventJs:function(){jQuery(window).on("load",(function(){jQuery("#jform_startdate, #jform_enddate, .time-hours , .time-minutes").on("change, blur",(function(){0===jQuery("#jform_venue")[0].length&&jtSite.eventform.venueDisplay()})),jtAdmin.event.showTicketCapacity()})),jQuery(document).ready((function(){var radioValue=jQuery("input[name='jform[online_events]']:checked").val(),id=document.getElementById("jform_id").value,selectedVenueDetails="";jQuery("#attendeefields .subform-repeatable-wrapper").length&&jQuery("#attendeefields .subform-repeatable-wrapper .subform-repeatable .btn-toolbar.hidden:first").removeClass("hidden");var venueDisplayPromise=jtAdmin.event.venueDisplay();jtAdmin.event.existingEvents(),venueDisplayPromise.then((function(){jtAdmin.event.showLocation()})),jtAdmin.event.selectExistingEventOnload(),jQuery("input[name='jform[online_events]']").change((function(){jtAdmin.event.venueDisplay(),jtAdmin.event.existingEvents(),jtAdmin.event.showTicketCapacity()})),jQuery(".group-add").on("click",(function(){setTimeout((function(){jtAdmin.event.showTicketAvailability()}),150)})),jQuery.each(mediaGallery,(function(key,media){tjMediaFile.previewFile(media,1)})),jQuery("#jform_venue").change((function(){jtAdmin.event.showLocation()})),jQuery(".venueCheck").change((function(){jtAdmin.event.selectExistingEvent(),jtAdmin.event.showTicketCapacity()})),jQuery(".existingEvent").change((function(){jtAdmin.event.existingEventSelection()})),jQuery("#jform_created_by").change((function(){jtAdmin.event.checkUserEmail()})),jQuery('input[type=radio][name="jform[venuechoice]"]').on("click",(function(){var venuechoicestatus;"existing"==jQuery('input[type=radio][name="jform[venuechoice]"]:checked').val()?jQuery("#existingEvent").show():jQuery("#existingEvent").hide()})),jQuery(document).on("subform-row-add",(function(event,row){jQuery("input.price").change((function(){var returnValue=jtAdmin.event.getRoundedValue(this.value);if(returnValue){jQuery(this.id).focus();var error_html="";return error_html+=Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+returnValue,Joomla.renderMessages({warning:[error_html]}),!1}}))})),jQuery("input.price").change((function(){var returnValue=jtAdmin.event.getRoundedValue(this.value);if(returnValue){jQuery(this.id).focus();var error_html="";return error_html+=Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+returnValue,Joomla.renderMessages({warning:[error_html]}),!1}})),jQuery("#jform_location").change((function(){if(googleMapApiKey){var geocoder=new google.maps.Geocoder,address=jQuery("#jform_location").val();geocoder.geocode({address:address},(function(results,status){if(status==google.maps.GeocoderStatus.OK){var latitude=results[0].geometry.location.lat(),longitude=results[0].geometry.location.lng();jQuery("#jform_latitude").val(latitude),jQuery("#jform_longitude").val(longitude)}}))}})),jtSite.eventform.displayNotices(ticketAccessState),jQuery(document).on("subform-row-add",(function(event,row){jtSite.eventform.displayNotices(ticketAccessState)}))})),Joomla.submitbutton=function(task){if(jQuery("#toolbar-apply, #toolbar-save, #toolbar-save-new").addClass("disabled"),"event.cancel"==task)jQuery("#toolbar-apply, #toolbar-save, #toolbar-save-new").removeClass("disabled"),Joomla.submitform(task,document.getElementById("adminForm"));else{if(!document.formvalidator.isValid(document.getElementById("adminForm")))return jQuery("html, body").animate({scrollTop:jQuery("#system-message-container").position().top}),jQuery("#toolbar-apply, #toolbar-save, #toolbar-save-new").removeClass("disabled"),!1;if(jQuery("#accept_privacy_term").length&&1!=jQuery("#accept_privacy_term").prop("checked"))return alert(Joomla.JText._("COM_JTICKETING_PRIVACY_TERMS_AND_CONDITIONS_ERROR")),jQuery("#toolbar-apply, #toolbar-save, #toolbar-save-new").removeClass("disabled"),!1}var eventStartDate=document.getElementById("jform_startdate").value,eventEndDate=document.getElementById("jform_enddate").value,compareStartDate=new Date(eventStartDate),compareEndDate=new Date(eventEndDate),eventBookingStartDate=document.getElementById("jform_booking_start_date").value,eventBookingEndDate=document.getElementById("jform_booking_end_date").value,compareBookingStartDate=new Date(eventBookingStartDate),compareBookingEndDate=new Date(eventBookingEndDate),id;if(("event.save"==task||"event.save2new"==task||"event.apply"==task)&&"0"!=document.getElementById("jform_id").value){var oldEventStartDateInFormat=Number(new Date(oldEventStartDate)),eventStartDateInFormat=Number(new Date(eventStartDate)),oldEventEndDateInFormat=Number(new Date(oldEventEndDate)),eventEndDateInFormat=Number(new Date(eventEndDate)),result;if(oldEventStartDateInFormat!=eventStartDateInFormat||oldEventEndDateInFormat!=eventEndDateInFormat)if(1!=confirm(Joomla.JText._("COM_JTICKETING_SAVE_THE_EVENT_CHANGED_DATES")))return jQuery("#toolbar-apply, #toolbar-save, #toolbar-save-new").removeClass("disabled"),!1}var value=new Array;jQuery(".price").each((function(){let price=jQuery(this).val().isInteger?jQuery(this).val():Math.round(100*jQuery(this).val())/100;returnValue=jtAdmin.event.getRoundedValue(price),returnValue&&value.push(returnValue)}));var errorCode=new Array;if(jQuery(".ticket-end-date").each((function(){var ticketEndDt=new Date(jQuery(this).val());"Invalid Date"!=ticketEndDt&&(""==eventBookingEndDate&&ticketEndDt>compareEndDate?(jQuery(this.id).focus(),errorCode.push(Joomla.JText._("COM_JTICKETING_TICKET_END_DATE_GREATER_EVENT_END_DATE_ERROR"))):"Invalid Date"!=compareBookingEndDate&&ticketEndDt>compareBookingEndDate&&(jQuery(this.id).focus(),errorCode.push(Joomla.JText._("COM_JTICKETING_TICKET_END_DATE_GREATER_BOOKING_END_DATE_ERROR"))),""==eventBookingStartDate&&ticketEndDt<new Date?(jQuery(this.id).focus(),errorCode.push(Joomla.JText._("COM_JTICKETING_TICKET_END_DATE_LESS_EVENT_MODIFICATION_DATE_ERROR"))):"Invalid Date"!=compareBookingStartDate&&ticketEndDt<compareBookingStartDate&&(jQuery(this.id).focus(),errorCode.push(Joomla.JText._("COM_JTICKETING_TICKET_END_DATE_LESS_BOOKING_START_DATE_ERROR"))))})),eventStartDate&&eventBookingStartDate){var eventStartDateTime=new Date(eventStartDate),eventBookingStartDateTime;new Date(eventBookingStartDate)>eventStartDateTime&&(jQuery("jform_startdate").focus(),errorCode.push(Joomla.JText._("COM_JTICKETING_BOOKING_START_DATE_WITH_EVENT_DATE_ERROR")))}if("event.save"==task||"event.save2new"==task||"event.apply"==task){if(1==tncForCreateEvent&&!1===document.getElementById("accept_privacy_term").checked)return alert(Joomla.JText._("COM_JTICKETING_PRIVACY_TERMS_AND_CONDITIONS_ERROR")),jQuery("#toolbar-apply, #toolbar-save, #toolbar-save-new").removeClass("disabled"),!1;if(selectedVenueDetails){var totalEnteredSeats=0;if(techjoomla.jQuery("input.avail").each((function(){totalEnteredSeats+=parseInt(techjoomla.jQuery(this).val())})),totalEnteredSeats>selectedVenueDetails.capacity_count)return alert(Joomla.JText._("COM_JTICKETING_VENUE_CAPACITY_ERROR")),jQuery("#toolbar-apply, #toolbar-save, #toolbar-save-new").removeClass("disabled"),!1}if(jQuery("#jform_start_number_for_event_level_sequence").length){const alphanumericRegex=/^[a-zA-Z0-9]+$/;if(jQuery("#jform_start_number_for_event_level_sequence").val()&&!alphanumericRegex.test(jQuery("#jform_start_number_for_event_level_sequence").val())){var error_html="";return jQuery("#toolbar-apply, #toolbar-save, #toolbar-save-new").removeClass("disabled"),error_html+=Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+": "+Joomla.JText._("COM_JTICKETING_START_NUMBER_FOR_EVENT_LEVEL_SEQUENCE"),Joomla.renderMessages({warning:[error_html]}),void jQuery("#jform_start_number_for_event_level_sequence").focus()}for(var i=0;;){var allowSequence="jform[tickettypes][tickettypes"+i+"][allow_ticket_level_sequence]";if(!jQuery('input[name="'+allowSequence+'"]:checked').length)break;if(jQuery('input[name="'+allowSequence+'"]:checked').val()){var sequenceId="#jform_tickettypes__tickettypes"+i+"__start_number_for_sequence";if(jQuery(sequenceId).length&&jQuery(sequenceId).val()&&!alphanumericRegex.test(jQuery(sequenceId).val())){var error_html="";return jQuery("#toolbar-apply, #toolbar-save, #toolbar-save-new").removeClass("disabled"),error_html+=Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+": "+Joomla.JText._("COM_JTICKETING_START_NUMBER_FOR_SEQUENCE"),Joomla.renderMessages({warning:[error_html]}),void jQuery(sequenceId).focus()}}i++}}if(0!=errorCode.length){var error_html="";for(index=0;index<errorCode.length;++index)error_html+=errorCode[index]+"<br>";return Joomla.renderMessages({warning:[error_html]}),!1}if(0!=value.length)jQuery(value).each((function(){var error_html="";return error_html+=Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+value,Joomla.renderMessages({warning:[error_html]}),jQuery("#toolbar-apply, #toolbar-save, #toolbar-save-new").removeClass("disabled"),!1}));else if(compareEndDate<=compareStartDate){var error_html="";error_html+="<br />"+Joomla.JText._("COM_JTICKETING_FORM_LBL_EVENT_DATE_ERROR"),Joomla.renderMessages({warning:[error_html]})}else if("Invalid Date"!=compareBookingStartDate&&"Invalid date"!=compareBookingEndDate&&compareBookingEndDate<=compareBookingStartDate){var error_html="";error_html+="<br />"+Joomla.JText._("COM_JTICKETING_FORM_LBL_EVENT_BOOKING_DATE_ERROR"),Joomla.renderMessages({warning:[error_html]})}else if("Invalid date"!=compareBookingEndDate&&compareEndDate<compareBookingEndDate){var error_html="";error_html+="<br />"+Joomla.JText._("COM_JTICKETING_FORM_LBL_EVENT_BOOKING_EVENT_END_ERROR"),Joomla.renderMessages({warning:[error_html]})}else{for(var i=0;;){var unlimited="#jform_tickettypes__tickettypes"+i+"__unlimited_seats",flag=0,available="#jform_tickettypes__tickettypes"+i+"__available";if(!jQuery(unlimited).length)break;if(0==jQuery(unlimited).val()&&(jQuery(available).val()<=0||!/^\d+$/.test(jQuery(available).val()))){flag=1;var error_html="";error_html+=Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+": "+Joomla.JText._("COM_JTICKETING_INVALID_SEAT_COUNT_ERROR"),Joomla.renderMessages({warning:[error_html]}),jQuery(available).focus();break}i++}var validData;1==document.formvalidator.isValid(document.getElementById("adminForm"))&&0==flag&&(jtAdmin.event.showLocation(),Joomla.submitform(task,document.getElementById("adminForm")))}}else Joomla.submitform(task,document.getElementById("adminForm"));jQuery("#toolbar-apply, #toolbar-save, #toolbar-save-new").removeClass("disabled")}},showLocation:function(){var venue=parseInt(jQuery("#jform_venue").val()),onlineOfflineVenues=jQuery("input[name='jform[online_events]']:checked").val();if(0==parseInt(enableOnlineVenues))selectedVenue>0&&0===venue?(jQuery("#event-location").show(),jQuery("#jform_location").prop("required",!0),jQuery("#jform_location").addClass("required")):selectedVenue>0?(jQuery("#event-location").hide(),jQuery("#jform_location").prop("required",!1),jQuery("#jform_location").removeClass("required")):0!=venue&&venue?(jQuery("#event-location").hide(),jQuery("#jform_location").prop("required",!1),jQuery("#jform_location").removeClass("required")):(jQuery("#event-location").show(),jQuery("#jform_location").prop("required",!0),jQuery("#jform_location").addClass("required"));else if(selectedVenue>0&&!venue)jQuery("#event-location").show(),jQuery("#jform_location").prop("required",!0),jQuery("#jform_location").addClass("required");else if(0==venue&&"0"===onlineOfflineVenues)jQuery("#event-location").show(),jQuery("#jform_location").prop("required",!0),jQuery("#jform_location").addClass("required");else if(venue||"0"!==onlineOfflineVenues)jQuery("#event-location").hide(),jQuery("#jform_location").prop("required",!1),jQuery("#jform_location").removeClass("required");else{var venuevalue=jQuery("#jform_venue").val();jQuery("#event-location").show(),jQuery("#jform_location").prop("required",!0),jQuery("#jform_location").addClass("required")}},showTicketCapacity:function(){var venue=parseInt(jQuery("#jform_venue").val());if(techjoomla.jQuery(".ticketCapacityNote").addClass("af-d-none"),techjoomla.jQuery(".unlimited-seats option[value='1']").prop("disabled",!1),jQuery(".unlimited-seats").trigger("liszt:updated"),jQuery(".unlimited-seats").trigger("chosen:updated"),venue){var requestObject={};requestObject.venue=venue,JSON.stringify(requestObject),jQuery.ajax({type:"POST",dataType:"json",data:requestObject,url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&format=json&task=venue.getCapacity",success:function(result){result&&(result.data&&0==result.data.seats_capacity?(techjoomla.jQuery(".unlimited-seats").each((function(){techjoomla.jQuery(this).val()||techjoomla.jQuery(this).val("")})),techjoomla.jQuery(".unlimited-seats option[value='1']").prop("disabled",!0),jQuery(".unlimited-seats").trigger("liszt:updated"),jQuery(".unlimited-seats").trigger("chosen:updated"),techjoomla.jQuery(".ticketCapacityNote").removeClass("af-d-none"),techjoomla.jQuery(".ticketCapacityNote").html(Joomla.JText._("COM_JTICKETING_TICKET_CAPACITY_ALERT")+result.data.capacity_count),selectedVenueDetails=result.data):(1==result.data&&alert(result.message),selectedVenueDetails=""))}})}else selectedVenueDetails=""},showTicketAvailability:function(){var venue;(jQuery("#jform_venue").val()?parseInt(jQuery("#jform_venue").val()):0)&&selectedVenueDetails&&(techjoomla.jQuery(".unlimited-seats").each((function(){techjoomla.jQuery(this).val()||techjoomla.jQuery(this).val("")})),techjoomla.jQuery(".unlimited-seats option[value='1']").prop("disabled",!0),jQuery(".unlimited-seats").trigger("liszt:updated"),jQuery(".unlimited-seats").trigger("chosen:updated"),techjoomla.jQuery(".ticketCapacityNote").removeClass("af-d-none"),techjoomla.jQuery(".ticketCapacityNote").html(Joomla.JText._("COM_JTICKETING_TICKET_CAPACITY_ALERT")+selectedVenueDetails.capacity_count))},checkUserEmail:function(){var user=document.getElementById("jform_created_by_id").value,userObject={};userObject.user=user,JSON.stringify(userObject),jQuery.ajax({type:"POST",dataType:"json",data:userObject,url:"index.php?option=com_jticketing&format=json&task=event.checkUserEmail",success:function(data){jQuery("#warning_message").empty(),data.check&&(1!=array_check&&1!=handle_transactions||jQuery("#warning_message").html('<div class="alert alert-warning">'+Joomla.JText._("COM_JTICKETING_PAYMENT_DETAILS_ERROR_MSG1")+'<a href= "index.php?option=com_tjvendors&view=vendor&layout=update&client=com_jticketing&vendor_id='+data.vendor_id+'" target="_blank">'+Joomla.JText._("COM_JTICKETING_VENDOR_FORM_LINK")+"</a>"+Joomla.JText._("COM_JTICKETING_PAYMENT_DETAILS_ERROR_MSG2")))}})},getRoundedValue:function(value){var errorMsg="";return jQuery.ajax({type:"POST",dataType:"json",data:{price:value},async:!1,url:"index.php?option=com_jticketing&format=json&task=event.getRoundedValue&price="+value,success:function(data){if(data.data==value)return value;roundedPrice=data.data,errorMsg=Joomla.JText._("COM_JTICKETING_VALIDATE_ROUNDED_PRICE").concat(roundedPrice)}}),errorMsg},venueDisplay:function(){return new Promise((function(resolve,reject){var radioValue=jQuery("input[name='jform[online_events]']:checked").val(),eventStartDate=document.getElementById("jform_startdate").value,eventEndDate=document.getElementById("jform_enddate").value,created_by=document.getElementById("jform_created_by_id").value,onlineOfflineVenues=jQuery("input[name='jform[online_events]']:checked").val(),selectedVenue=jQuery("#jform_venue").val();"1"==onlineOfflineVenues?(jQuery("#event-location").hide(),jQuery("#venuechoice_id").show(),jQuery("#existingEvent").show()):(jQuery("#venuechoice_id").hide(),jQuery("#existingEvent").hide());var userObject={};userObject.radioValue=radioValue,userObject.eventStartTime=eventStartDate,userObject.eventEndTime=eventEndDate,userObject.created_by=created_by,userObject.eventId=eventId,userObject.venueId=venueId,jQuery("#jform_venue, .chzn-results").empty(),JSON.stringify(userObject),jQuery.ajax({type:"POST",data:userObject,dataType:"json",url:"index.php?option=com_jticketing&format=json&task=event.getVenueList",success:function(data){if(""==data&&0==eventId&&1==radioValue){jQuery("#jform_venue").prop("disabled",!0);var op="<option value='0' selected='selected'>"+Joomla.JText._("COM_JTICKETING_NO_ONLINE_VENUE_ERROR")+"</option>";jQuery("#jform_venue").append(op),jQuery("#jform_venue").trigger("liszt:updated"),jQuery("#jform_venue").trigger("chosen:updated");var error_html="";error_html+="<br />"+Joomla.JText._("COM_JTICKETING_NO_VENUE_ERROR_MSG"),Joomla.renderMessages({warning:[error_html]})}else if(0!=eventId){var onlineOfflineVenues;1==jQuery("input[name='jform[online_events]']:checked").val()&&jQuery("#jform_venue").prop("disabled",!0),0==venueId&&(jQuery("#jform_venue, .chzn-results").empty(),venueName=Joomla.JText._("COM_JTICKETING_CUSTOM_LOCATION"));var op="<option value='"+venueId+"' selected='selected'>"+venueName+" </option>";for(jQuery("#jform_venue").append(op),jQuery("#jform_venue").trigger("liszt:updated"),jQuery("#jform_venue").trigger("chosen:updated"),index=0;index<data.length;++index){var op="<option value='"+data[index].value+"' > "+data[index].text+"</option>";jQuery("#jform_venue").append(op),jQuery("#jform_venue").trigger("liszt:updated"),jQuery("#jform_venue").trigger("chosen:updated")}}else{jQuery("#jform_venue").prop("disabled",!1);var op="<option value='' selected='selected'>"+Joomla.JText._("COM_JTICKETING_FORM_EVENT_DEFAULT_VENUE_OPTION")+"</option>";for(jQuery("#jform_venue").append(op),jQuery("#jform_venue").trigger("liszt:updated"),jQuery("#jform_venue").trigger("chosen:updated"),index=0;index<data.length;++index){var op="<option value='"+data[index].value+"' > "+data[index].text+"</option>";jQuery("#jform_venue").append(op),jQuery("#jform_venue").trigger("liszt:updated"),jQuery("#jform_venue").trigger("chosen:updated")}}resolve()}})}))},ConvertTimeformat:function(date,hours,minutes,amPm){hours=parseInt(hours),"PM"==amPm&&hours<12&&(hours+=12),"AM"==amPm&&12==hours&&(hours-=12),hours<10&&(hours="0"+hours),(minutes=parseInt(minutes))<10&&(minutes="0"+minutes);var time,utcDateTime=new Date(date+" "+hours+":"+minutes+":00").toISOString(),formattedUtcDateTime;return(utcDateTime=utcDateTime.substring(0,utcDateTime.length-5)).replace("T"," ")},existingEvents:function(){var radioValue=jQuery("input[name='jform[online_events]']:checked").val(),existingEventChoice;"new"==jQuery("input[name='jform[venuechoice]']:checked").val()&&"1"==radioValue?jQuery("#form_existingEvent").hide():jQuery("#form_existingEvent").show()},selectExistingEvent:function(){var venueId=document.getElementById("jform_venue").value,venuestatus=jQuery('input[type=radio][name="jform[online_events]"]:checked').val();jQuery("#jform_existing_event option").remove();var eventDropdown=jQuery("#jform_existing_event"),op="<option value='' selected='selected'>"+Joomla.JText._("COM_JTICKETING_FORM_SELECT_EXISTING_EVENT_OPTION")+"</option>";eventDropdown.append(op),"0"!=venueId&&"1"==venuestatus&&JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",data:{task:"event.getAllMeetings",venueId:venueId}}).done((function(result){if(!0===result.success){var eventList=result.data;null!=eventList&&Array.isArray(eventList)&&eventList.forEach((function(event){op=existing_url==event.id?"<option value='"+event.id+"' selected='selected'>"+event.title+" ("+event.start_time+")</option>":"<option value='"+event.id+"' >"+event.title+" ("+event.start_time+")</option>",eventDropdown.append(op)}))}})).fail((function(content){Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_EVENT_RELATED_AJAX_FAIL_ERROR_MESSAGE")]})})).always((function(){eventDropdown.trigger("liszt:updated"),eventDropdown.trigger("chosen:updated")}))},selectExistingEventOnload:function(){if(!existing_url){var venuestatus=jQuery('input[type=radio][name="jform[online_events]"]:checked').val();if("0"!=venueId&&"1"==venuestatus){jQuery("#jform_existing_event option").remove();var eventDropdown=jQuery("#jform_existing_event"),op="<option value='' selected='selected'>"+Joomla.JText._("COM_JTICKETING_FORM_SELECT_EXISTING_EVENT_OPTION")+"</option>";eventDropdown.append(op),JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",data:{task:"event.getAllMeetings",venueId:venueId}}).done((function(result){if(!0===result.success){var eventList=result.data;null!=eventList&&Array.isArray(eventList)&&eventList.forEach((function(event){op=existing_url==event.id?"<option value='"+event.id+"' selected='selected'>"+event.title+" ("+event.start_time+")</option>":"<option value='"+event.id+"' >"+event.title+" ("+event.start_time+")</option>",eventDropdown.append(op)}))}})).fail((function(content){Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_EVENT_RELATED_AJAX_FAIL_ERROR_MESSAGE")]})})).always((function(){eventDropdown.trigger("liszt:updated"),eventDropdown.trigger("chosen:updated")}))}}},existingEventSelection:function(){var venueId=document.getElementById("jform_venue").value,venueurl=jQuery("#jform_existing_event :selected").val();jQuery("#event_url").val(venueurl),jQuery.ajax({type:"POST",async:!1,data:{venueId:venueId,venueurl:venueurl},dataType:"json",url:"index.php?option=com_jticketing&format=json&task=event.getScoID",success:function(data){jQuery("#event_sco_id").val(data)},error:function(response){console.log(" ERROR!!")}})},validateDates:function(){var event_start_date_old=jQuery("#jform_startdate").val(),event_end_date_old=jQuery("#jform_enddate").val(),booking_start_date_old=jQuery("#jform_booking_start_date").val(),booking_end_date_old=jQuery("#jform_booking_end_date").val();return!0}},orders:{initOrdersJs:function(){Joomla.submitbutton=function(task){if("orders.remove"==task){var result;if(1!=confirm(Joomla.JText._("COM_JTICKETING_ORDER_DELETE_CONF")))return!1;Joomla.submitform(task,document.getElementById("adminForm"))}}},selectStatusOrder:function(appid,processor,ele){document.getElementById("order_id").value=appid,document.getElementById("payment_status").value=ele.value,document.getElementById("processor").value=processor;var selInd=ele.selectedIndex,status=ele.options[selInd].value,orderStatusvalue="",task="orders.save";if("RF"===status&&(orderStatusvalue="REFUND"),"E"===status&&(orderStatusvalue="FAILED"),"D"===status&&(orderStatusvalue="DECLINE"),"CRV"===status&&(orderStatusvalue="CANCEL_REVERSED"),"RV"===status&&(orderStatusvalue="REVERSED"),"RF"===status||"E"===status||"D"===status||"CRV"===status||"RV"===status){var orderStatusLanguageConstant="COM_JTICKETING_ORDER_STATUS_"+orderStatusvalue,orderStatusMessage=Joomla.JText._("COM_JTICKETING_ORDER_STATUS_MESSAGE1")+Joomla.JText._(orderStatusLanguageConstant)+Joomla.JText._("COM_JTICKETING_ORDER_STATUS_MESSAGE2"),confirmation;if(!0!==confirm(orderStatusMessage)){var oldStatus=jQuery(ele).data("oldvalue");return jQuery(ele).val(oldStatus),jQuery(ele).trigger("liszt:updated"),jQuery(ele).trigger("chosen:updated"),!1}Joomla.submitform(task,document.getElementById("adminForm"))}else Joomla.submitform(task,document.getElementById("adminForm"))}},venue:{initializeGMapSuggest:function(){input=document.getElementById("jform_address");var autocomplete=new google.maps.places.Autocomplete(input)},initVenueJs:function(){googleMapApiKey&&google.maps.event.addDomListener(window,"load",jtAdmin.venue.initializeGMapSuggest),jQuery(document).ready((function(){jQuery('input[name="jform[online]').click((function(){jtAdmin.venue.showOnlineOffline(jQuery('input[name="jform[online]"]:checked').val())})),jtAdmin.venue.showOnlineOffline(jQuery('input[name="jform[online]"]:checked').val()),jQuery("#jform_online_provider").change((function(){jtAdmin.venue.getPluginParams()})),jQuery.each(mediaGallery,(function(key,media){tjMediaFile.previewFile(media,1)})),editId&&1==jQuery('input[name="jform[online]"]:checked').val()&&jtAdmin.venue.getPluginParams(),getValue&&jQuery("#jform_online_provider").trigger("change"),jtAdmin.venue.venueCapacityCheck(),jQuery("#jform_seats_capacity").change((function(){jtAdmin.venue.venueCapacityCheck()}))}))},showOnlineOffline:function(ifonline){1==ifonline?(jQuery("#jform_online_provider").closest(".control-group").show(),jQuery("#provider_html").show(),jQuery("#jform_offline_provider").hide()):(jQuery("#jform_online_provider").closest(".control-group").hide(),jQuery("#provider_html").hide(),jQuery("#jform_offline_provider").show())},venueCapacityCheck:function(){0==jQuery("#jform_seats_capacity").val()?jQuery("#jform_capacity_count").addClass("required"):jQuery("#jform_capacity_count").removeClass("required")},venueSubmitButton:function(task){if("venue.apply"==task||"venue.save"==task||"venue.save2new"==task){var venue_name=jQuery('input[name="jform[jform_name]"]:checked').val(),api_username=jQuery('input[name="jform[api_username]"]:checked').val(),api_password=jQuery('input[name="jform[api_password]"]:checked').val(),host_url=jQuery('input[name="jform[host_url]"]:checked').val(),source_sco_id=jQuery('input[name="jform[source_sco_id]"]:checked').val(),onlines=jQuery('input[name="jform[online]"]:checked').val(),onlineProvider=jQuery("#jform_online_provider").val();if(editId&&"0"==onlines&&(jQuery("#api_username").val(""),jQuery("#api_password").val(""),jQuery("#host_url").val(""),jQuery("#source_sco_id").val("")),!document.formvalidator.isValid(document.getElementById("venue-form")))return jQuery("html, body").animate({scrollTop:jQuery("#system-message-container").position().top}),!1;if(1==jQuery('input[name="jform[online]"]:checked').val()){if(!onlineProvider||"0"==onlineProvider)return error_html=Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+Joomla.JText._("COM_JTICKETING_ONLINE_EVENTS_PROVIDER"),Joomla.renderMessages({warning:[error_html]}),!1;let providerHtmlForm=document.createElement("form");for(fields=jQuery("#provider_html").find("input, textarea, select, fieldset"),i=0,l=fields.length;i<l;i++){let element=fields[i].cloneNode(!0);providerHtmlForm.appendChild(element)}if(!document.formvalidator.isValid(providerHtmlForm))return!1;jsonObj=[],jQuery("#provider_html input").each((function(){var id=jQuery(this).attr("id"),output=jQuery(this).val();item={},item.id=id,item.output=output;var source=jsonObj.push(item);jsonString=JSON.stringify(item),jQuery("#venue_params").val(jsonString)}))}else if(!jQuery("#jform_address").val()){var error_html="";return jQuery("#jform_address").val()||(error_html+="<br />"+Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+Joomla.JText._("COM_JTICKETING_FORM_LBL_VENUE_ADDRESS")),Joomla.renderMessages({warning:[error_html]}),!1}if(!jQuery("#jform_name").val()){var error_html="";return error_html+="<br />"+Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+Joomla.JText._("COM_JTICKETING_FORM_LBL_VENUE_TITLE"),Joomla.renderMessages({warning:[error_html]}),!1}jQuery("#system-message-container").html(""),Joomla.submitform(task,document.getElementById("venue-form"))}"venue.cancel"==task&&Joomla.submitform(task,document.getElementById("venue-form"))},getPluginParams:function(){var element=jQuery("#jform_online_provider").val();function initializeGoogleMap(){input=document.getElementById("jform_address");var autocomplete=new google.maps.places.Autocomplete(input)}jQuery.ajax({type:"POST",url:"index.php?option=com_jticketing&task=venue.getelementparams",data:{element:element,venue_id:jQuery("#venue_id").val()},datatype:"HTML",async:"false",success:function(response){jQuery("#provider_html").html(JSON.parse(response).data);var online=jQuery('input[name="jform[online]"]:checked').val();jQuery("#provider_html").css("display","none"),1==online&&(jQuery("#provider_html").css("display","block"),jQuery("#provider_html").trigger("subform-row-add",jQuery("#provider_html")));for(var passwordSelection=document.getElementsByClassName("input-password-toggle"),i=0;i<passwordSelection.length;i++)!function(index){passwordSelection[index].addEventListener("click",(function(){"password"==jQuery(this).prev("input").attr("type")?jQuery(this).prev("input").attr("type","text"):jQuery(this).prev("input").attr("type","password")}))}(i)},error:function(){return jQuery("#provider_html").hide(),!0}}),googleMapApiKey&&google.maps.event.addDomListener(window,"load",initializeGoogleMap)},getLongitudeLatitude:function(){if(googleMapApiKey){var geocoder=new google.maps.Geocoder,address=jQuery("#jform_address").val();geocoder.geocode({address:address},(function(results,status){if(status==google.maps.GeocoderStatus.OK){var latitude=results[0].geometry.location.lat(),longitude=results[0].geometry.location.lng();jQuery("#jform_latitude").val(latitude),jQuery("#jform_longitude").val(longitude)}}))}},getCurrentLocation:function(){if(navigator.geolocation)navigator.geolocation.getCurrentPosition(showLocation);else{var address=Joomla.JText._("COM_JTICKETING_ADDRESS_NOT_FOUND"),lonlatval=Joomla.JText._("COM_JTICKETING_LONG_LAT_VAL");jQuery("#jform_address").val(address),jQuery("#jform_longitude").val(lonlatval),jQuery("#jform_latitude").val(lonlatval)}function showLocation(position){var latitude=position.coords.latitude,longitude=position.coords.longitude;jQuery.ajax({type:"POST",url:"index.php?option=com_jticketing&task=venue.getLocation",data:"latitude="+latitude+"&longitude="+longitude,dataType:"json",success:function(data){console.log(data);var address=data.location,longitude=data.longitude,latitude=data.latitude;data&&(jQuery("#jform_address").val(address),jQuery("#jform_longitude").val(longitude),jQuery("#jform_latitude").val(latitude))}})}}},coupon:{initCouponJs:function(){jQuery(document).ready((function(){jQuery("#jform_vendor_id").change((function(){jtAdmin.coupon.updateVendorEventsList(this)})),jQuery("#jform_value").change((function(){validation.checkForZeroAndAlpha(this,"46",Joomla.JText._("COM_JTICKETING_ENTER_NUMERICS")),jQuery('#coupon-form input[name="jform[val_type]"]:checked').length&&"1"==jQuery('#coupon-form input[name="jform[val_type]"]:checked').val()&&jQuery("#jform_value").val()&&parseInt(jQuery("#jform_value").val())>100&&(alert(Joomla.JText._("COM_JTICKETING_COUPON_PERCENTAGE_ERROR")),jQuery("#jform_value").val(""))})),jQuery('#coupon-form input[name="jform[val_type]').change((function(){jQuery('#coupon-form input[name="jform[val_type]"]:checked').length&&"1"==jQuery('#coupon-form input[name="jform[val_type]"]:checked').val()&&jQuery("#jform_value").val()&&parseInt(jQuery("#jform_value").val())>100&&(alert(Joomla.JText._("COM_JTICKETING_COUPON_PERCENTAGE_ERROR")),jQuery("#jform_value").val(""))})),jQuery("#jform_limit").change((function(){validation.checkForZeroAndAlpha(this,"46",Joomla.JText._("COM_JTICKETING_ENTER_NUMERICS"))})),jQuery("#jform_max_per_user").change((function(){validation.checkForZeroAndAlpha(this,"46",Joomla.JText._("COM_JTICKETING_ENTER_NUMERICS"))}))}))},couponSubmitButton:function(task){if(jQuery('#coupon-form input[name="jform[val_type]"]:checked').length&&"1"==jQuery('#coupon-form input[name="jform[val_type]"]:checked').val()&&jQuery("#jform_value").val()&&parseInt(jQuery("#jform_value").val())>100)return alert(Joomla.JText._("COM_JTICKETING_COUPON_PERCENTAGE_ERROR")),jQuery("#jform_value").val(""),!1;"coupon.cancel"==task?Joomla.submitform(task,document.getElementById("coupon-form")):"coupon.cancel"!=task&&document.formvalidator.isValid(document.getElementById("coupon-form"))&&Joomla.submitform(task,document.getElementById("coupon-form"))},updateVendorEventsList:function(element){var vendorId=element.value;jQuery.ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&task=coupons.getVendorSpecificEvents",type:"GET",data:"vendorId="+vendorId,dataType:"json",success:function(data){if(1!==data.error||null!==data)if(jQuery("#jform_event_ids").find("option").remove(),jQuery("#jform_event_ids").trigger("liszt:updated"),jQuery("#jform_event_ids").trigger("chosen:updated"),0!==data.events.length)for(var i=0;i<data.events.length;i++)jQuery("#jform_event_ids").append(new Option(data.events[i].title,data.events[i].id)),jQuery("#jform_event_ids").trigger("liszt:updated"),jQuery("#jform_event_ids").trigger("chosen:updated");else alert(Joomla.JText._("COM_JTICKETING_COUPON_NO_EVENT_FOUND"))}})}}};function showOnlineOffline(ifonline){1==ifonline?(jQuery("#jform_online_provider").closest(".control-group").show(),jQuery("#provider_html").show(),jQuery("#jform_offline_provider").hide()):(jQuery("#jform_online_provider").closest(".control-group").hide(),jQuery("#provider_html").hide(),jQuery("#jform_offline_provider").show())}function validateOnlineOffline(ifonline){1==ifonline?(jQuery("#jform_online_provider").closest(".control-group").show(),jQuery("#provider_html").show(),jQuery("#jform_offline_provider").hide(),jQuery("#jform_address").removeAttr("required"),jQuery("#jform_address").removeClass("required")):(jQuery("#jform_online_provider").closest(".control-group").hide(),jQuery("#provider_html").hide(),jQuery("#jform_offline_provider").show(),jQuery("#api_username").removeAttr("required"),jQuery("#api_username").removeClass("required"),jQuery("#host_url").removeAttr("required"),jQuery("#host_url").removeClass("required"),jQuery("#api_password").removeAttr("required"),jQuery("#api_password").removeClass("required"),jQuery("#source_sco_id").removeAttr("required"),jQuery("#source_sco_id").removeClass("required"))}var tjMediaFile={validateFile:function(thisFile,isGallary,isAdmin,task){thisFile instanceof jQuery||(thisFile=jQuery(thisFile));var uploadType=jQuery(thisFile).attr("type");if("file"==uploadType){var uploadedfile=jQuery(thisFile)[0].files[0];if(mediaSize<uploadedfile.size/1e6)return alert(Joomla.JText._("COM_TJMEDIA_VALIDATE_MEDIA_SIZE")),!1;tjMediaFile.uploadFile(uploadedfile,thisFile,uploadType,isGallary,isAdmin,task)}else fileLink=jQuery("#jform_gallery_link").val(),tjMediaFile.uploadFile(fileLink,thisFile,"link",isGallary,isAdmin,task)},uploadFile:function(uploadedfile,thisFile,uploadType,isGallary,isAdmin,task){var mediaformData=new FormData;"file"==uploadType?(mediaformData.append("file[]",uploadedfile),mediaformData.append("upload_file",uploadType),mediaformData.append("isGallary",isGallary)):"link"==uploadType&&(mediaformData.append("upload_type",uploadType),mediaformData.append("name",uploadedfile),mediaformData.append("type","youtube")),url=0!=isAdmin?"index.php?option=com_jticketing&format=json&task="+task+".uploadMedia":Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&format=json&task="+task+".uploadMedia",this.ajaxObj=jQuery.ajax({type:"POST",url:url,dataType:"JSON",contentType:!1,processData:!1,data:mediaformData,xhr:function(){var myXhr=jQuery.ajaxSettings.xhr();return myXhr.upload&&myXhr.upload.addEventListener("progress",(function(e){if(e.lengthComputable){var percentage=Math.floor(e.loaded/e.total*100);tjMediaFile.progressBar.updateStatus(thisFile.id,percentage)}}),!1),myXhr},beforeSend:function(x){tjMediaFile.progressBar.init(thisFile.id,"")},success:function(data){if(jQuery("#system-message-container").empty(),data.success)1===isGallary&&("video.youtube"==data.data[0].type||0===data.data[0].valid?jQuery("#jform_gallery_link").val(""):jQuery(thisFile).val("")),tjMediaFile.previewFile(data.data[0],isGallary),tjMediaFile.progressBar.statusMsg(thisFile.id,"success",data.message);else if("link"==uploadType){var jmsgs=[data.message];Joomla.renderMessages({warning:jmsgs})}else jQuery(thisFile).val(""),jQuery("#"+thisFile.id).siblings(".progress").remove(),tjMediaFile.progressBar.statusMsg(thisFile.id,"error",data.message),alert(data.message)},error:function(xhr,status,error){tjMediaFile.progressBar.statusMsg(thisFile.id,"error",error)}})},previewFile:function(data,isGallary){return data.id&&(1==isGallary?tjMediaFile.tjMediaGallery.appendMediaToGallary(data):2==isGallary?(jQuery("#uploaded_media_cover").attr("src",data[eventMainImage]),jQuery("#uploaded_media_cover").closest(".thumbnails").removeClass("hide_jtdiv"),jQuery("#jform_event_cover_old_image").val(jQuery("#jform_event_coverImage").val()),jQuery("#jform_event_coverImage").val(data.id)):(jQuery("#uploaded_media").attr("src",data[eventMainImage]),jQuery("#uploaded_media").closest(".thumbnails").removeClass("hide_jtdiv"),jQuery("#jform_event_old_image").val(jQuery("#jform_event_image").val()),jQuery("#jform_event_image").val(data.id))),!1},progressBar:{init:function(divId,msg){jQuery("#"+divId).siblings(".alert").remove(),jQuery("#"+divId).siblings(".progress").remove(),this.progress=jQuery("<div class='progress progress-striped active'><div class='bar'></div><button onclick='return tjexport.abort();' class='btn btn-danger btn-small pull-right'>Abort</button></div>"),this.statusBar=this.progress.find(".bar"),this.abort=jQuery("<div class='abort'><span>Abort</span></div>").appendTo(this.statusbar),jQuery("#"+divId).closest(".controls").append(this.progress)},updateStatus:function(divId,percentage){this.statusBar.css("width",percentage+"%"),this.statusBar.text(percentage+"%")},abort:function(){if(!confirm(Joomla.JText._("LIB_TECHJOOMLA_CSV_EXPORT_CONFIRM_ABORT")))return!1;this.ajaxObj.abort()},statusMsg:function(divId,alert,msg){setTimeout((function(){jQuery("#"+divId).siblings(".progress").remove()}),2e3);var closeBtn,msgDiv=jQuery("<div class='alert alert-"+alert+"'><strong>"+msg+"</strong>"+"<a href='#' class='close' data-dismiss='alert' aria-label='close' title='close'>×</a>"+"</div>");jQuery("#"+divId).closest(".controls").append(msgDiv)}},tjMediaGallery:{appendMediaToGallary:function(mediaData){var $newMedia=jQuery(".gallary__media li.gallary__media--li:first-child").clone(),type=mediaData.type.split(".");if("video"===type[0]){var videoWidth=jQuery(".jt-event-frontend-edit").length?"107":"160";"youtube"===type[1]?mediaTag="<iframe width=' "+videoWidth+"' height='113' src="+mediaData.path+"> </iframe>":mediaTag="<video width=' "+videoWidth+"' height='113' class='media_video_width' preload='metadata' controls ><source src="+mediaData.path+"></video>"}else"image"===type[0]&&(mediaTag="<img src="+mediaData[galleryImage]+" class='media_image_width'>");$newMedia.removeClass("hide"),$newMedia.find(".thumbnail").append(mediaTag),$newMedia.find(".media_field_value").val(mediaData.id),$newMedia.find(".media_field_value").attr("id","media_id_"+mediaData.id),$newMedia.appendTo(".gallary__media")},deleteMedia:function(currentDiv,isAdmin,clientId,task){var $currentDiv=jQuery(currentDiv);if(url=1==isAdmin?"index.php?option=com_jticketing&format=json&task="+task+".deleteMedia":Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&format=json&task="+task+".deleteMedia",!confirm(Joomla.JText._("JGLOBAL_CONFIRM_DELETE")))return!1;var mediaId=$currentDiv.next().val();jQuery.ajax({type:"POST",url:url,dataType:"JSON",data:{id:mediaId,client_id:clientId},success:function(data){$currentDiv.closest(".gallary__media--li").remove()},error:function(xhr,status,error){tjMediaFile.progressBar.statusMsg($currentDiv.id,"error",error)}})}}},attendees={enrollmentStatusBar:{createStatusbar:function(obj){this.statusbar=jQuery("<div class='statusbar'></div>"),this.filename=jQuery("<div class='filename'></div>").appendTo(this.statusbar),this.size=jQuery("<div class='filesize'></div>").appendTo(this.statusbar),this.success=jQuery('<div class="msg alert"></div>').appendTo(this.statusbar),this.error=jQuery('<div class="msg alert"></div>').appendTo(this.statusbar),obj.closest(".controls").append(this.statusbar),this.setFileNameSize=function(name,size){var sizeStr="",sizeKB=size/1024,sizeMB;parseInt(sizeKB)>1024?sizeStr=(sizeKB/1024).toFixed(2)+" MB":sizeStr=sizeKB.toFixed(2)+" KB";this.filename.html(name),this.size.html(sizeStr)},this.setMsg=function(msg,classname){if(this.statusbar.show(),msg.errormsg){var error=msg.errormsg;this.error.addClass("alert alert-error"),this.error.html(error),this.error.show()}if(msg.successmsg){var success=msg.successmsg;this.success.addClass("alert alert-success"),this.success.html(success),this.success.show()}if(msg.messages){var $message=jQuery("<div>").addClass("import-messages");this.success.removeClass("msg alert"),jQuery.each(msg.messages,(function(i,value){var key=Object.keys(value)[0],curMessage=jQuery("<div>").addClass("alert alert-"+key).html(value[key]).get(0);$message.append(curMessage)})),this.success.html($message),this.success.show()}}}}},jtCommon={enrollment:{validate_import:function(thisfile,userImport,loaderId,csvType){if(!jQuery(thisfile).val())return!1;jQuery(thisfile).closest(".controls").children(".statusbar").remove();var obj=jQuery(thisfile),status=new attendees.enrollmentStatusBar.createStatusbar(obj),uploadedfile=jQuery(thisfile)[0].files[0],notifyUser=jQuery("#notify_user_enroll").prop("checked"),filename=uploadedfile.name,fileExt;if("csv"!=filename.split(".").pop()){var finalMsg=new Object;return finalMsg.errormsg=nonvalid_extension,status.setMsg(finalMsg,"alert-error"),!1}jtCommon.enrollment.progressBar(loaderId,!0);var file_name_container=jQuery(".fileupload-preview",jQuery(thisfile).closest(".fileupload-new"));jQuery(file_name_container).show(),jQuery(file_name_container).text(filename),jtCommon.enrollment.startImporting(uploadedfile,status,thisfile,userImport,loaderId,csvType,notifyUser)},progressBar:function(loaderId,action){return!!loaderId&&(1==action?jQuery("<div class='control-group'><div class='progress-line'></div></div>").prependTo(loaderId):jQuery(loaderId+" .progress-line").remove(),jQuery(loaderId+" :input").prop("disabled",action),jQuery(loaderId+" :button").prop("disabled",action),!0)},startImporting:function(file,status,thisfile,userImport,loaderId,csvType,notifyUser){var finalMsg=new Object;if(void 0===file)return status.setMsg(file_not_selected_error,"alert-error"),!1;if(void 0!==window.FormData){if(1==userImport)var userImports=1,newfilename=jtCommon.enrollment.sendImportFileToServer(file,status,thisfile,1,loaderId,notifyUser);return!1}alert("You need to upgrade your browser as it does not support FormData")},sendImportFileToServer:function(file,status,thisfile,userImports,loaderId,notifyUser){var formData=new FormData;formData.append("FileInput",file),formData.append("notifyUser",notifyUser);var returnvar=!0,jqXHR=jQuery.ajax({url:"index.php?option=com_jticketing&task=attendees.csvImport&tmpl=component",type:"POST",data:formData,mimeType:"multipart/form-data",contentType:!1,dataType:"json",cache:!1,processData:!1,success:function(response){var output=response.OUTPUT,result;1==output.return&&(status.setMsg(output),jQuery("#user-csv-upload").val(""),jtCommon.enrollment.progressBar(loaderId,!1))},error:function(jqXHR,textStatus="",errorThrown=""){var finalMsg=new Object;finalMsg.errormsg=jqXHR.responseText,status.setMsg(finalMsg,"alert-error"),jtCommon.enrollment.progressBar(loaderId,!1),returnvar=!1}});return returnvar},updateEnrollment:function(elementId,id,task,isAdmin){var contextValue="",notify=jQuery("#notify_user_"+elementId).is(":checked"),eid=jQuery("#eid_"+elementId).val();if("update"===task?contextValue=jQuery("#assign_"+elementId+" option:selected").val():"moveAttendee"===task&&(contextValue="M"),"M"===contextValue){jQuery("#move_attendee").modal("show");var ownerId=jQuery("#owner_"+elementId).val();jQuery("#userId").val(ownerId),jQuery("#eventId").val(eid),jQuery("#attendeeId").val(id),jQuery("#selected_event option[value='"+eid+"']").remove(),jQuery("#selected_event").trigger("liszt:updated"),jQuery("#selected_event").trigger("chosen:updated")}else url=1===isAdmin?"index.php?option=com_jticketing&task=attendees."+task:jtRootURL+"index.php?option=com_jticketing&task=attendees."+task,jQuery("#ajax_loader").html("<img src="+Joomla.getOptions("system.paths").base+"/media/com_jticketing/images/ajax-loader.gif>"),jQuery("#ajax_loader").show(),jQuery.ajax({url:url,type:"POST",dataType:"json",data:{id:id,value:contextValue,notify:notify,eid:eid},beforeSend:function(){jQuery("#ajax_loader").html("<img src="+Joomla.getOptions("system.paths").base+"/media/com_jticketing/images/ajax-loader.gif>")},complete:function(){jQuery("#ajax_loader").hide()},success:function(result){Joomla.renderMessages(result.messages),location.reload()}})},saveEnrollment:function(task){return 0==document.adminForm.boxchecked.value?(alert(Joomla.JText._("COM_JTICKETING_SELECT_USER_TO_ENROLL")),!1):jQuery("#selected_events").val()?void Joomla.submitform("enrollment."+task):(alert(Joomla.JText._("COM_JTICKETING_SELECT_EVENT_TO_ENROLL")),!1)},deleteEnrollment:function(id){confirm(Joomla.JText._("COM_JTICKETING_ARE_YOU_SURE_YOU_TO_DELETE_THE_ATTENDEE"))&&(url=Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&task=attendees.remove",jQuery.ajax({url:url,type:"POST",dataType:"json",data:{id:id},beforeSend:function(){jQuery("#ajax_loader").html("<img src="+Joomla.getOptions("system.paths").base+"/media/com_jticketing/images/ajax-loader.gif>")},complete:function(){jQuery("#ajax_loader").hide()},success:function(result){alert(result.message),location.reload()},error:function(data){console.log(data.message)}}))}},waitinglist:{changeStatus:function(elementId,ids){var statusValue=jQuery("#assign_"+elementId+" option:selected").val(),eventId=jQuery("#event_id_"+elementId).val(),userId=jQuery("#user_id_"+elementId).val();"C"==statusValue?(document.getElementById("wid").value=ids,Joomla.submitform("waitinglist.enroll")):"CA"==statusValue&&(1===isAdmin?url="index.php?option=com_jticketing&format=json&task=waitlistform.changeStatus":url=jtRootURL+"index.php?option=com_jticketing&format=json&task=waitlistform.changeStatus",jQuery.ajax({url:url,type:"POST",dataType:"json",data:{id:ids,status:statusValue,eventid:eventId,userid:userId},beforeSend:function(){jQuery("#ajax_loader").html("<img src="+Joomla.getOptions("system.paths").base+"/media/com_jticketing/images/ajax-loader.gif>")},complete:function(){jQuery("#ajax_loader").hide()},success:function(result){if(result.success){var jmsgs=[result.message];Joomla.renderMessages({success:jmsgs})}else{var msg=[result.message];Joomla.renderMessages({error:msg})}}}))}},attendees:{attendeesSubmitButton:function(task,isAdmin){if(""===task)return!1;var emailIds=document.getElementById("selected_emailids"),messageSubject=document.getElementById("jt-message-subject"),messageBody=tinyMCE.activeEditor.getContent(),action;if("cancelEmail"!=task.split(".")[1]){var message={error:[]};if(""===messageSubject.value)return jQuery("#system-message-container").removeClass("span10"),jQuery("#system-message-container").addClass("span12"),message.error.push(Joomla.JText._("COM_JTICKETING_EMAIL_SUBJECT_ERROR_MSG")),Joomla.renderMessages(message),!1;if(""===messageBody)return jQuery("#system-message-container").removeClass("span10"),jQuery("#system-message-container").addClass("span12"),message.error.push(Joomla.JText._("COM_JTICKETING_EMAIL_BODY_ERROR_MSG")),Joomla.renderMessages(message),!1}else Joomla.submitform(task);url=jtRootURL+"index.php?option=com_jticketing&format=json&task="+task,jQuery.ajax({url:url,type:"POST",dataType:"json",data:{messageSubject:messageSubject.value,messageBody:messageBody,isAdmin:isAdmin,emailIds:emailIds.value},beforeSend:function(){document.getElementById("ajax_loader").style.backgroundImage="url("+jtRootURL+"/media/com_jticketing/images/loadinfo.gif)",jQuery("#ajax_loader").show()},complete:function(){jQuery("#ajax_loader").hide()},success:function(result){result.success?(Joomla.renderMessages({success:[result.message]}),window.onbeforeunload=null,window.location.href=result.data):Joomla.renderMessages({error:[result.message]})}})}}},jtCounter={jtCountDown:function(divId,startDate,endDate,currentDate,isReverse){var counterDate=startDate;isReverse&&(counterDate=endDate),jQuery("#"+divId).countdown(counterDate).on("update.countdown",(function(event){var format=msg="";event.offset.totalDays>0?(msg=Joomla.JText._("JT_EVENT_COUNTER_STARTS_IN_DAYS"),isReverse&&(msg=Joomla.JText._("JT_EVENT_COUNTER_ENDS_IN_DAYS")),format=msg.replace("%s","%-D")):0==event.offset.totalDays&&(msg=Joomla.JText._("JT_EVENT_COUNTER_STARTS_IN_TIME"),isReverse&&(msg=Joomla.JText._("JT_EVENT_COUNTER_ENDS_IN_TIME")),format=msg.replace("%s","%H:%M:%S")),jQuery(this).html(event.strftime(format))})).on("finish.countdown",(function(event){endDate>currentDate&&jtCounter.jtCountDown(divId,startDate,endDate,currentDate,"1"),endDate<currentDate&&jQuery(this).html(Joomla.JText._("JT_EVENT_COUNTER_EXPIRE"))})).on("stoped.countdown",(function(event){jQuery(this).html(Joomla.JText._("JT_EVENT_COUNTER_EXPIRE"))}))}},validation={positiveNumber:function(){jQuery(window).on("load",(function(){document.formvalidator.setHandler("positive-number",(function(value,element){var regex;return value=punycode.toASCII(value),/^[+]?([0-9]+(?:[\.][0-9]*)?|\.[0-9]+)$/.test(value)}))}))},formatDateTime:function(dateTime){var year=dateTime.getFullYear(),month=""+(dateTime.getMonth()+1),date=""+dateTime.getDate(),hour=""+dateTime.getHours(),minutes=""+dateTime.getMinutes(),seconds=""+dateTime.getSeconds(),formattedDateTime;return month.length<2&&(month="0"+month),date.length<2&&(date="0"+date),hour.length<2&&(hour="0"+hour),minutes.length<2&&(minutes="0"+minutes),seconds.length<2&&(seconds="0"+seconds),year+"-"+month+"-"+date+" "+hour+":"+minutes+":"+seconds},checkForZeroAndAlpha:function(ele,allowedChar,msg){ele.value<=0&&(alert(Joomla.JText._("COM_JTICKETING_MIN_AMT_SHOULD_GREATER_MSG")),ele.value="")}};